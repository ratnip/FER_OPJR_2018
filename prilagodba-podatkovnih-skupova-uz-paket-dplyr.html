<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Programirajmo u R-u</title>
  <meta name="description" content="Udzbenik za vještinu ‘Osnove programskog jezika R’ na Fakultetu elektrotehnike i racunarstva, Sveuciliste u Zagrebu.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Programirajmo u R-u" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Udzbenik za vještinu ‘Osnove programskog jezika R’ na Fakultetu elektrotehnike i racunarstva, Sveuciliste u Zagrebu." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Programirajmo u R-u" />
  
  <meta name="twitter:description" content="Udzbenik za vještinu ‘Osnove programskog jezika R’ na Fakultetu elektrotehnike i racunarstva, Sveuciliste u Zagrebu." />
  

<meta name="author" content="Damir Pintar">


<meta name="date" content="2018-12-11">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="datumi.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />








<style type="text/css">
.showopt {
  background-color: #004c93;
  color: #FFFFFF; 
  width: 140px;
  height: 4	0px;
  text-align: center;
  vertical-align: middle !important;
  float: right;
  font-family: sans-serif;
  font-size:10 pt;
  border-radius: 8px;
}

.showopt:hover {
    background-color: #dfe4f2;
    color: #004c93;
}

pre.plot {
  background-color: white !important;
}
</style>

<script>
 $(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Prikaži rješenje</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Prikaži ispis</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Prikaži sliku</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Prikaži") >= 0) {
      $(this).html(label.replace("Prikaži", "Sakrij"));
    } else {
      $(this).html(label.replace("Sakrij", "Prikaži"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>(Udžbenik za vještinu “Osnove programskog jezika R”)</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#predgovor"><i class="fa fa-check"></i>Predgovor</a></li>
</ul></li>
<li class="part"><span><b>I Osnovni elementi jezika R</b></span></li>
<li class="chapter" data-level="1" data-path="uvod.html"><a href="uvod.html"><i class="fa fa-check"></i><b>1</b> Uvod</a><ul>
<li class="chapter" data-level="1.1" data-path="uvod.html"><a href="uvod.html#sto-je-programski-jezik-r"><i class="fa fa-check"></i><b>1.1</b> Što je programski jezik R?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="uvod.html"><a href="uvod.html#opcenito-o-r-u"><i class="fa fa-check"></i><b>1.1.1</b> Općenito o R-u</a></li>
<li class="chapter" data-level="1.1.2" data-path="uvod.html"><a href="uvod.html#alternative-jeziku-r"><i class="fa fa-check"></i><b>1.1.2</b> Alternative jeziku R</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="uvod.html"><a href="uvod.html#instalacija-programske-podrske"><i class="fa fa-check"></i><b>1.2</b> Instalacija programske podrške</a></li>
<li class="chapter" data-level="1.3" data-path="uvod.html"><a href="uvod.html#pregled-razvojnog-sucelja-rstudio"><i class="fa fa-check"></i><b>1.3</b> Pregled razvojnog sučelja <em>RStudio</em></a><ul>
<li class="chapter" data-level="1.3.1" data-path="uvod.html"><a href="uvod.html#interaktivna-konzola"><i class="fa fa-check"></i><b>1.3.1</b> Interaktivna konzola</a></li>
<li class="chapter" data-level="1.3.2" data-path="uvod.html"><a href="uvod.html#pisanje-r-skripti"><i class="fa fa-check"></i><b>1.3.2</b> Pisanje R skripti</a></li>
<li class="chapter" data-level="1.3.3" data-path="uvod.html"><a href="uvod.html#r-markdown"><i class="fa fa-check"></i><b>1.3.3</b> <em>R Markdown</em></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="uvod.html"><a href="uvod.html#kako-koristiti-ovaj-udzbenik"><i class="fa fa-check"></i><b>1.4</b> Kako koristiti ovaj udžbenik?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tipovi.html"><a href="tipovi.html"><i class="fa fa-check"></i><b>2</b> Osnovni tipovi podataka i operatori</a><ul>
<li class="chapter" data-level="2.1" data-path="tipovi.html"><a href="tipovi.html#osnovni-tipovi-podataka"><i class="fa fa-check"></i><b>2.1</b> Osnovni tipovi podataka</a></li>
<li class="chapter" data-level="2.2" data-path="tipovi.html"><a href="tipovi.html#operatori"><i class="fa fa-check"></i><b>2.2</b> Operatori</a></li>
<li class="chapter" data-level="2.3" data-path="tipovi.html"><a href="tipovi.html#nedostajuce-nepoznate-i-nemoguce-vrijednosti"><i class="fa fa-check"></i><b>2.3</b> Nedostajuće, nepoznate i nemoguće vrijednosti</a></li>
<li class="chapter" data-level="" data-path="tipovi.html"><a href="tipovi.html#zadaci-za-vjezbu"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vektori.html"><a href="vektori.html"><i class="fa fa-check"></i><b>3</b> Vektori, matrice i liste</a><ul>
<li class="chapter" data-level="3.1" data-path="vektori.html"><a href="vektori.html#vektori-1"><i class="fa fa-check"></i><b>3.1</b> Vektori</a><ul>
<li class="chapter" data-level="3.1.1" data-path="vektori.html"><a href="vektori.html#stvaranje-vektora"><i class="fa fa-check"></i><b>3.1.1</b> Stvaranje vektora</a></li>
<li class="chapter" data-level="3.1.2" data-path="vektori.html"><a href="vektori.html#operator"><i class="fa fa-check"></i><b>3.1.2</b> Operator <code>[</code></a></li>
<li class="chapter" data-level="3.1.3" data-path="vektori.html"><a href="vektori.html#principi-vektorizacije-i-recikliranja"><i class="fa fa-check"></i><b>3.1.3</b> Principi vektorizacije i recikliranja</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vektori.html"><a href="vektori.html#indeksni-vektori"><i class="fa fa-check"></i><b>3.2</b> Indeksni vektori</a><ul>
<li class="chapter" data-level="3.2.1" data-path="vektori.html"><a href="vektori.html#lokacijsko-referenciranje"><i class="fa fa-check"></i><b>3.2.1</b> Lokacijsko referenciranje</a></li>
<li class="chapter" data-level="3.2.2" data-path="vektori.html"><a href="vektori.html#uvjetno-referenciranje"><i class="fa fa-check"></i><b>3.2.2</b> Uvjetno referenciranje</a></li>
<li class="chapter" data-level="3.2.3" data-path="vektori.html"><a href="vektori.html#imensko-referenciranje"><i class="fa fa-check"></i><b>3.2.3</b> Imensko referenciranje</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vektori.html"><a href="vektori.html#matrice-i-polja"><i class="fa fa-check"></i><b>3.3</b> Matrice i polja</a><ul>
<li class="chapter" data-level="3.3.1" data-path="vektori.html"><a href="vektori.html#rezanje-matrica"><i class="fa fa-check"></i><b>3.3.1</b> Rezanje matrica</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vektori.html"><a href="vektori.html#liste"><i class="fa fa-check"></i><b>3.4</b> Liste</a></li>
<li class="chapter" data-level="" data-path="vektori.html"><a href="vektori.html#zadaci-za-vjezbu-1"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="okviri.html"><a href="okviri.html"><i class="fa fa-check"></i><b>4</b> Podatkovni okviri i faktori</a><ul>
<li class="chapter" data-level="4.1" data-path="okviri.html"><a href="okviri.html#podatkovni-okviri"><i class="fa fa-check"></i><b>4.1</b> Podatkovni okviri</a></li>
<li class="chapter" data-level="4.2" data-path="okviri.html"><a href="okviri.html#odabir-redaka-i-stupaca-podatkovnih-okvira"><i class="fa fa-check"></i><b>4.2</b> Odabir redaka i stupaca podatkovnih okvira</a></li>
<li class="chapter" data-level="4.3" data-path="okviri.html"><a href="okviri.html#dodavanje-i-brisanje-redaka-i-stupaca"><i class="fa fa-check"></i><b>4.3</b> Dodavanje i brisanje redaka i stupaca</a></li>
<li class="chapter" data-level="4.4" data-path="okviri.html"><a href="okviri.html#faktori"><i class="fa fa-check"></i><b>4.4</b> Faktori</a></li>
<li class="chapter" data-level="" data-path="okviri.html"><a href="okviri.html#zadaci-za-vjezbu-2"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="kontrola.html"><a href="kontrola.html"><i class="fa fa-check"></i><b>5</b> Kontrola toka i objekti</a><ul>
<li class="chapter" data-level="5.1" data-path="kontrola.html"><a href="kontrola.html#naredbe-kontrole-toka"><i class="fa fa-check"></i><b>5.1</b> Naredbe kontrole toka</a><ul>
<li class="chapter" data-level="5.1.1" data-path="kontrola.html"><a href="kontrola.html#uvjetno-izvoenje-naredbi"><i class="fa fa-check"></i><b>5.1.1</b> Uvjetno izvođenje naredbi</a></li>
<li class="chapter" data-level="5.1.2" data-path="kontrola.html"><a href="kontrola.html#programske-petlje"><i class="fa fa-check"></i><b>5.1.2</b> Programske petlje</a></li>
<li class="chapter" data-level="5.1.3" data-path="kontrola.html"><a href="kontrola.html#petlja-repeat"><i class="fa fa-check"></i><b>5.1.3</b> Petlja <code>repeat</code></a></li>
<li class="chapter" data-level="5.1.4" data-path="kontrola.html"><a href="kontrola.html#petlja-while"><i class="fa fa-check"></i><b>5.1.4</b> Petlja <code>while</code></a></li>
<li class="chapter" data-level="5.1.5" data-path="kontrola.html"><a href="kontrola.html#petlja-for"><i class="fa fa-check"></i><b>5.1.5</b> Petlja <code>for</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="kontrola.html"><a href="kontrola.html#objektni-modeli-u-jeziku-r"><i class="fa fa-check"></i><b>5.2</b> Objektni modeli u jeziku R</a><ul>
<li class="chapter" data-level="5.2.1" data-path="kontrola.html"><a href="kontrola.html#pregled-objektnog-modela-s3"><i class="fa fa-check"></i><b>5.2.1</b> Pregled objektnog modela S3</a></li>
<li class="chapter" data-level="5.2.2" data-path="kontrola.html"><a href="kontrola.html#genericke-funkcije"><i class="fa fa-check"></i><b>5.2.2</b> Generičke funkcije</a></li>
<li class="chapter" data-level="5.2.3" data-path="kontrola.html"><a href="kontrola.html#zakljucci-o-s3-objektima"><i class="fa fa-check"></i><b>5.2.3</b> Zaključci o S3 objektima</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="kontrola.html"><a href="kontrola.html#zadaci-za-vjezbu-3"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="paketi.html"><a href="paketi.html"><i class="fa fa-check"></i><b>6</b> Paketi, ugrađene funkcije i okoline</a><ul>
<li class="chapter" data-level="6.1" data-path="paketi.html"><a href="paketi.html#rad-s-paketima"><i class="fa fa-check"></i><b>6.1</b> Rad s paketima</a></li>
<li class="chapter" data-level="6.2" data-path="paketi.html"><a href="paketi.html#ugraene-funkcije"><i class="fa fa-check"></i><b>6.2</b> Ugrađene funkcije</a></li>
<li class="chapter" data-level="6.3" data-path="paketi.html"><a href="paketi.html#okoline"><i class="fa fa-check"></i><b>6.3</b> Okoline</a></li>
<li class="chapter" data-level="" data-path="paketi.html"><a href="paketi.html#zadaci-za-vjezbu-4"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="korisnik.html"><a href="korisnik.html"><i class="fa fa-check"></i><b>7</b> Korisnički definirane funkcije</a><ul>
<li class="chapter" data-level="7.1" data-path="korisnik.html"><a href="korisnik.html#kako-definirati-funkciju"><i class="fa fa-check"></i><b>7.1</b> Kako definirati funkciju</a><ul>
<li class="chapter" data-level="7.1.1" data-path="korisnik.html"><a href="korisnik.html#princip-kopiranja-kod-izmjene-copy-on-modify"><i class="fa fa-check"></i><b>7.1.1</b> Princip “kopiranja kod izmjene” (copy-on-modify)</a></li>
<li class="chapter" data-level="7.1.2" data-path="korisnik.html"><a href="korisnik.html#funkcija-kao-objekt"><i class="fa fa-check"></i><b>7.1.2</b> Funkcija kao objekt</a></li>
<li class="chapter" data-level="7.1.3" data-path="korisnik.html"><a href="korisnik.html#genericke-funkcije-1"><i class="fa fa-check"></i><b>7.1.3</b> Generičke funkcije</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="korisnik.html"><a href="korisnik.html#zadaci-za-vjezbu-5"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="apply.html"><a href="apply.html"><i class="fa fa-check"></i><b>8</b> Porodica funkcija <code>apply</code></a><ul>
<li class="chapter" data-level="8.1" data-path="apply.html"><a href="apply.html#sto-su-apply-funkcije"><i class="fa fa-check"></i><b>8.1</b> Što su <code>apply</code> funkcije?</a></li>
<li class="chapter" data-level="8.2" data-path="apply.html"><a href="apply.html#funkcija-apply"><i class="fa fa-check"></i><b>8.2</b> Funkcija <code>apply</code></a></li>
<li class="chapter" data-level="8.3" data-path="apply.html"><a href="apply.html#funkcije-lapply-sapply-i-vapply"><i class="fa fa-check"></i><b>8.3</b> Funkcije <code>lapply</code>, <code>sapply</code> i <code>vapply</code></a></li>
<li class="chapter" data-level="8.4" data-path="apply.html"><a href="apply.html#ostale-funkcije-iz-porodice-apply-i-dostupne-alternative"><i class="fa fa-check"></i><b>8.4</b> Ostale funkcije iz porodice <code>apply</code> i dostupne alternative</a></li>
<li class="chapter" data-level="" data-path="apply.html"><a href="apply.html#zadaci-za-vjezbu-6"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="part"><span><b>II Upravljanje podacima i vizualizacije</b></span></li>
<li class="chapter" data-level="9" data-path="cijev.html"><a href="cijev.html"><i class="fa fa-check"></i><b>9</b> Operator cjevovoda i uredni podaci</a><ul>
<li class="chapter" data-level="9.1" data-path="cijev.html"><a href="cijev.html#operator-cjevovoda"><i class="fa fa-check"></i><b>9.1</b> Operator cjevovoda</a></li>
<li class="chapter" data-level="9.2" data-path="cijev.html"><a href="cijev.html#uredni-podaci"><i class="fa fa-check"></i><b>9.2</b> Uredni podaci</a><ul>
<li class="chapter" data-level="9.2.1" data-path="cijev.html"><a href="cijev.html#funkcije-gather-i-spread"><i class="fa fa-check"></i><b>9.2.1</b> Funkcije <code>gather</code> i <code>spread</code></a></li>
<li class="chapter" data-level="9.2.2" data-path="cijev.html"><a href="cijev.html#funkcije-separate-i-unite"><i class="fa fa-check"></i><b>9.2.2</b> Funkcije <code>separate</code> i <code>unite</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cijev.html"><a href="cijev.html#zadaci-za-vjezbu-7"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="datumi.html"><a href="datumi.html"><i class="fa fa-check"></i><b>10</b> Rad sa datumima i znakovnim nizovima</a><ul>
<li class="chapter" data-level="10.1" data-path="datumi.html"><a href="datumi.html#rad-sa-datumima"><i class="fa fa-check"></i><b>10.1</b> Rad sa datumima</a><ul>
<li class="chapter" data-level="10.1.1" data-path="datumi.html"><a href="datumi.html#klasa-date"><i class="fa fa-check"></i><b>10.1.1</b> Klasa <code>Date</code></a></li>
<li class="chapter" data-level="10.1.2" data-path="datumi.html"><a href="datumi.html#klase-posixct-i-posixlt"><i class="fa fa-check"></i><b>10.1.2</b> Klase <code>POSIXct</code> i <code>POSIXlt</code></a></li>
<li class="chapter" data-level="10.1.3" data-path="datumi.html"><a href="datumi.html#paket-lubridate"><i class="fa fa-check"></i><b>10.1.3</b> Paket <code>lubridate</code></a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="datumi.html"><a href="datumi.html#rad-sa-znakovnim-nizovima"><i class="fa fa-check"></i><b>10.2</b> Rad sa znakovnim nizovima</a><ul>
<li class="chapter" data-level="10.2.1" data-path="datumi.html"><a href="datumi.html#analiza-teksta-i-regularni-izrazi"><i class="fa fa-check"></i><b>10.2.1</b> Analiza teksta i regularni izrazi</a></li>
<li class="chapter" data-level="10.2.2" data-path="datumi.html"><a href="datumi.html#paket-stringr"><i class="fa fa-check"></i><b>10.2.2</b> Paket <code>stringr</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datumi.html"><a href="datumi.html#zadaci-za-vjezbu-8"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><i class="fa fa-check"></i><b>11</b> Prilagodba podatkovnih skupova uz paket <code>dplyr</code></a><ul>
<li class="chapter" data-level="11.1" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#ogledni-podatkovni-skup-titanic"><i class="fa fa-check"></i><b>11.1</b> Ogledni podatkovni skup: <em>Titanic</em></a></li>
<li class="chapter" data-level="11.2" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#stvaranje-podskupa-obzervacija-uz-filter-i-slice"><i class="fa fa-check"></i><b>11.2</b> Stvaranje podskupa obzervacija uz <code>filter</code> i <code>slice</code></a></li>
<li class="chapter" data-level="11.3" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#stvaranje-podskupa-varijabli-uz-select"><i class="fa fa-check"></i><b>11.3</b> Stvaranje podskupa varijabli uz <code>select</code></a></li>
<li class="chapter" data-level="11.4" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#stvaranje-novih-stupaca-uz-mutate"><i class="fa fa-check"></i><b>11.4</b> Stvaranje novih stupaca uz <code>mutate</code></a></li>
<li class="chapter" data-level="11.5" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#ogledni-podatkovni-skup-houston-flights"><i class="fa fa-check"></i><b>11.5</b> Ogledni podatkovni skup: <em>Houston flights</em></a></li>
<li class="chapter" data-level="11.6" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#grupiranje-i-agregacija-uz-group_by-i-summarise"><i class="fa fa-check"></i><b>11.6</b> Grupiranje i agregacija uz <code>group_by</code> i <code>summarise</code></a></li>
<li class="chapter" data-level="11.7" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#spajanje-podatkovnih-okvira-uz-join-funkcije"><i class="fa fa-check"></i><b>11.7</b> Spajanje podatkovnih okvira uz join funkcije</a></li>
<li class="chapter" data-level="11.8" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#integracija-sa-relacijskim-bazama-podataka"><i class="fa fa-check"></i><b>11.8</b> Integracija sa relacijskim bazama podataka</a></li>
<li class="chapter" data-level="" data-path="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html"><a href="prilagodba-podatkovnih-skupova-uz-paket-dplyr.html#zadaci-za-vjezbu-9"><i class="fa fa-check"></i>Zadaci za vježbu</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Programirajmo u R-u</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="prilagodba-podatkovnih-skupova-uz-paket-dplyr" class="section level1">
<h1><span class="header-section-number">11</span> Prilagodba podatkovnih skupova uz paket <code>dplyr</code></h1>
<p>Paket <code>dplyr</code> jedan je od novijih paketa jezika <em>R</em> čija je glavna funkcija učinkovito i pojednostavljeno upravljanje podatkovnim okvirima uz pomoć skupa intuitivno dizajniranih funkcija. U trenutku pisanja ove lekcije <a href = "https://www.rdocumentation.org/"> nalazi se na vrhu liste najpopularnijih paketa </a> usprkos jakoj “konkurenciji” u ovom području koju čine iznimno popularni paketi kao što su <code>plyr</code>, <code>data.table</code> ali i osnovne, tradicionalne metode za rad sa podatkovnim okvirima. Bilo koja od ovih opcija predstavlja dobar izbor, a iako paket <code>dplyr</code> nije najučinkovitiji glede samih performansi (daleko najbolje performanse trenutno nudi paket <code>data.table</code>), prednost ovog paketa je njegova intuitivna, čitljiva sintaksa koja programski rad sa podatkovnim okvirima čini brzim i jednostavnim te je odličan izbor za programere koji se upoznaju sa <em>R</em>-om ili se jednostavno žele usredotočiti na rad sa podacima kroz čitljiv, lako održiv programski kod.</p>
<p>Konkretne prednosti koje donosi paket dplyr su sljedeće:</p>
<ul>
<li>jednostavna sintaksa (slična SQL-u, ali proceduralna) koja koristi pet glavnih “glagola” za manipulaciju podatkovnim okvirima i kao takva definira svojevrsni samostalni jezik unutar jezika <em>R</em></li>
<li>veća učinkovitost od metoda koje nudi osnovni paket (inicijalno je <code>dplyr</code> dizajniran za veću učinkovitost programiranja, ne nužno za bolje performanse, no u međuvremenu implementacija određenih rutina u C-u omogućila je i poboljšanje i performansi izvođenja)</li>
<li>integracija sa relacijskim bazama podataka (funkcije paketa <code>dplyr</code> mogu se koristiti direktno nad tablicama u bazi uz pomoć automatskog prevođenja funkcija paketa <code>dplyr</code> u SQL naredbe)</li>
</ul>
<p>Spomenutih osnovnih “pet glagola” koje nudi paket <code>dplyr</code> su sljedeći:</p>
<ul>
<li><code>filter</code> - za filtriranje podatkovnog skupa po retcima</li>
<li><code>select</code> - za odabir pojedinih stupaca</li>
<li><code>arrange</code> - za promjenu redoslijeda redaka</li>
<li><code>mutate</code> - za stvaranje novih stupaca iz postojećih</li>
<li><code>summarise</code> - za agregiranje podataka</li>
</ul>
<p>Pored pet osnovnih glagola vrlo često koristimo i:</p>
<ul>
<li><code>group_by</code> za grupiranje podataka unutar podatkovnog skupa</li>
<li>porodicu <code>join</code> funkcija za spajanje podatkovnih okvira</li>
</ul>
<p>Poznavatelji jezika SQL lako će uočiti paralele između tog jezika i navedenih funkcionalnosti paketa <code>dplyr</code>. Najveća razlika jest u tome što SQL radi “deklarativno”, tj. moramo pratiti pravila izgradnje SQL naredbe koja “sve radi odjednom”, dok u <em>R</em>-u uz pomoć funkcija paketa <code>dplyr</code> i već ranije upoznatog operatora <code>%&gt;%</code> radnje nad podatkovnim skupovima možemo izvoditi proceduralno, s jasnim tijekom obrade podataka slijeva na desno.</p>
<p>Prije detaljnog pregleda funkcionalnosti paketa <code>dplyr</code> pogledajmo ogledni podatkovni skup kojeg ćemo koristiti tijekom ove lekcije.</p>
<div id="ogledni-podatkovni-skup-titanic" class="section level2">
<h2><span class="header-section-number">11.1</span> Ogledni podatkovni skup: <em>Titanic</em></h2>
<p>Odaberimo za početak jedan često korišteni podatkovni skup – <em>“Titanic Passenger Survival Dataset”</em>. Ovaj skup pruža informacije o sudbinama putnika prekoocenaskog putničkog broda Titanic koji je potonuo 14. travnja 1912. godine pri čemu je od 2223 putnika i članova posade preživjelo samo njih 706. Podatkovni skup između ostalog sadrži imena putnika, spol, godište u trenutku potonuća, putničku klasu i sl. Postoji inačica ovog podatkovnog skupa koja dolazi sa samom <em>R</em> distribucijom, no mi ćemo koristiti njegovu proširenu inačicu sa <em>Kaggle</em> natjecanja <em>“Titanic: Machine Learning From Disaster”</em> o kojem se više detalja može saznati na <a href = "https://www.kaggle.com/c/titanic">ovoj poveznici</a>.</p>
<p>Učitajmo navedeni podatkovni skup.</p>
<hr />
<p><strong>Zadatak 11.1 - podatkovni skup <code>Titanic</code></strong></p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" data-line-number="1"><span class="co">#učitajte podatkovni skup iz datoteke `Titanic.csv` u varijablu `titanic`</span></a>
<a class="sourceLine" id="cb432-2" data-line-number="2"></a>
<a class="sourceLine" id="cb432-3" data-line-number="3"><span class="co">#pogledajte strukturu podatkovnog okvira `titanic` uz pomoć funkcije `str`</span></a>
<a class="sourceLine" id="cb432-4" data-line-number="4"><span class="co">#i prvih nekoliko redaka uz pomoć funkcije `head`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" data-line-number="1">titanic &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;Titanic.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb433-2" data-line-number="2"></a>
<a class="sourceLine" id="cb433-3" data-line-number="3"><span class="kw">str</span>(titanic)</a>
<a class="sourceLine" id="cb433-4" data-line-number="4"><span class="kw">head</span>(titanic)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    891 obs. of  12 variables:
##  $ PassengerId: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Survived   : int  0 1 1 1 0 0 0 0 1 1 ...
##  $ Pclass     : int  3 1 3 1 3 3 1 3 3 2 ...
##  $ Name       : chr  &quot;Braund, Mr. Owen Harris&quot; &quot;Cumings, Mrs. John Bradley (Florence Briggs Thayer)&quot; &quot;Heikkinen, Miss. Laina&quot; &quot;Futrelle, Mrs. Jacques Heath (Lily May Peel)&quot; ...
##  $ Sex        : chr  &quot;male&quot; &quot;female&quot; &quot;female&quot; &quot;female&quot; ...
##  $ Age        : num  22 38 26 35 35 NA 54 2 27 14 ...
##  $ SibSp      : int  1 1 0 1 0 0 0 3 0 1 ...
##  $ Parch      : int  0 0 0 0 0 0 0 1 2 0 ...
##  $ Ticket     : chr  &quot;A/5 21171&quot; &quot;PC 17599&quot; &quot;STON/O2. 3101282&quot; &quot;113803&quot; ...
##  $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...
##  $ Cabin      : chr  &quot;&quot; &quot;C85&quot; &quot;&quot; &quot;C123&quot; ...
##  $ Embarked   : chr  &quot;S&quot; &quot;C&quot; &quot;S&quot; &quot;S&quot; ...
##   PassengerId Survived Pclass
## 1           1        0      3
## 2           2        1      1
## 3           3        1      3
## 4           4        1      1
## 5           5        0      3
## 6           6        0      3
##                                                  Name    Sex Age SibSp
## 1                             Braund, Mr. Owen Harris   male  22     1
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer) female  38     1
## 3                              Heikkinen, Miss. Laina female  26     0
## 4        Futrelle, Mrs. Jacques Heath (Lily May Peel) female  35     1
## 5                            Allen, Mr. William Henry   male  35     0
## 6                                    Moran, Mr. James   male  NA     0
##   Parch           Ticket    Fare Cabin Embarked
## 1     0        A/5 21171  7.2500              S
## 2     0         PC 17599 71.2833   C85        C
## 3     0 STON/O2. 3101282  7.9250              S
## 4     0           113803 53.1000  C123        S
## 5     0           373450  8.0500              S
## 6     0           330877  8.4583              Q</code></pre>
</div>
<hr />
<p>Prije nastavka pokažimo dvije funkcije dostupne preko paketa <code>dplyr</code> koje se mogu pokazati jako korisne kod rada sa podatkovnim okvirima: <code>tbl_df</code> i <code>glimpse</code>.</p>
<p>Funkcijom <code>tbl_df</code> pretvaramo obični podatkovni okvir u objekt klase <code>tbl</code>, koja je zapravo “omotač” oko podatkovnog okvira, a s ciljem da se rad s podacima učini u izvjesnoj mjeri praktičnijim. Najveća prednost ovog tipa objekta jest što će se kod pokušaja ispisa cijelog okvira na zaslon (što se najčešće događa omaškom i što rezultira “smrzavanjem” <em>R</em> konzole) pozvati posebna funkcija koja će ispisati samo dio okvira i moći će se odmah nastaviti s radom. Postoje i neke dodatne prednosti - npr. bilo kakav tip ispisa samih podataka na zaslon automatski se prilagođava širini zaslona - no prethodno navedena funkcionalnost je sama po sebi dovoljan razlog korištenja ove funkcije, što znaju svi korisnici <em>R</em>-a kojima se dogodio naprasni prekid procesa analize samo zbog nesmotrenog unosa imena varijable okvira i pritiska tipke <em>“enter”</em>.</p>
<p>Druga funkcija koju ćemo prikazati je <code>glimpse</code> - inačica funkcije str nešto intuitivnijeg imena koja također ima prednost maksimalnog iskorištavanja dostupnog prostora za ispis.</p>
<hr />
<p><strong>Zadatak 11.2 - funkcije <code>tbl_df</code> i <code>glimpse</code></strong></p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" data-line-number="1"><span class="co">#pozovite funkciju `tbl_df` nad tablicom `titanic`</span></a>
<a class="sourceLine" id="cb435-2" data-line-number="2"><span class="co">#rezultat smjestite u istu varijablu</span></a>
<a class="sourceLine" id="cb435-3" data-line-number="3"></a>
<a class="sourceLine" id="cb435-4" data-line-number="4"><span class="co">#pozovite funkciju `glimpse` nad tablicom `titanic`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" data-line-number="1">titanic &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(titanic)</a>
<a class="sourceLine" id="cb436-2" data-line-number="2"></a>
<a class="sourceLine" id="cb436-3" data-line-number="3"><span class="kw">glimpse</span>(titanic)</a></code></pre></div>
<pre><code>## Observations: 891
## Variables: 12
## $ PassengerId &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,...
## $ Survived    &lt;int&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0,...
## $ Pclass      &lt;int&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3,...
## $ Name        &lt;chr&gt; &quot;Braund, Mr. Owen Harris&quot;, &quot;Cumings, Mrs. John Bra...
## $ Sex         &lt;chr&gt; &quot;male&quot;, &quot;female&quot;, &quot;female&quot;, &quot;female&quot;, &quot;male&quot;, &quot;mal...
## $ Age         &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, ...
## $ SibSp       &lt;int&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4,...
## $ Parch       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1,...
## $ Ticket      &lt;chr&gt; &quot;A/5 21171&quot;, &quot;PC 17599&quot;, &quot;STON/O2. 3101282&quot;, &quot;1138...
## $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, ...
## $ Cabin       &lt;chr&gt; &quot;&quot;, &quot;C85&quot;, &quot;&quot;, &quot;C123&quot;, &quot;&quot;, &quot;&quot;, &quot;E46&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Embarked    &lt;chr&gt; &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;Q&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;C&quot;, ...</code></pre>
</div>
<hr />
<p>Uz pomoć funkcije <code>options</code> i parametara <code>tibble.print_max</code> i <code>tibble.width</code> možemo kontrolirati koliko u općenitom slučaju želimo ispisati stupaca i redaka u općenitom slučaju npr:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" data-line-number="1"><span class="co"># zelim u ispisu vidjeti najvise 10 redaka ali sve stupce</span></a>
<a class="sourceLine" id="cb438-2" data-line-number="2"><span class="kw">options</span>(<span class="dt">tibble.print_max =</span> <span class="dv">10</span>, <span class="dt">tibble.width =</span> <span class="ot">Inf</span>)</a></code></pre></div>
<p>a kod pojedinog ispisa broj redaka možemo birati uz pomoć parametra <code>n</code>:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb439-1" data-line-number="1"><span class="co"># `df` je klase `tbl`, zelim vidjeti 50 redaka u ispisu</span></a>
<a class="sourceLine" id="cb439-2" data-line-number="2"><span class="kw">print</span>(df, <span class="dt">n =</span> <span class="dv">50</span>)</a></code></pre></div>
<p>Funkcije <code>tbl_df</code> i <code>glimpse</code> nisu nužne za korištenje ostalih funkcija paketa <code>dplyr</code>, no u svakom slučaju se preporučuju.</p>
<p>Prije nastavka bilo bi dobro pobliže se upoznati sa podatkovnim skupom kojeg ćemo koristiti, bilo nešto detaljnijim istraživanjem podatkovnog skupa, bilo prikupljanjem dokumentacije o istom. Kraći opis samog podatkovnog skupa preuzet sa službenih stranica Keggle natjecanja slijedi:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1">VARIABLE DESCRIPTIONS<span class="op">:</span></a>
<a class="sourceLine" id="cb440-2" data-line-number="2">survival        Survival</a>
<a class="sourceLine" id="cb440-3" data-line-number="3">                (<span class="dv">0</span> =<span class="st"> </span>No; <span class="dv">1</span> =<span class="st"> </span>Yes)</a>
<a class="sourceLine" id="cb440-4" data-line-number="4">pclass          Passenger Class</a>
<a class="sourceLine" id="cb440-5" data-line-number="5">                (<span class="dv">1</span> =<span class="st"> </span>1st; <span class="dv">2</span> =<span class="st"> </span>2nd; <span class="dv">3</span> =<span class="st"> </span>3rd)</a>
<a class="sourceLine" id="cb440-6" data-line-number="6">name            Name</a>
<a class="sourceLine" id="cb440-7" data-line-number="7">sex             Sex</a>
<a class="sourceLine" id="cb440-8" data-line-number="8">age             Age</a>
<a class="sourceLine" id="cb440-9" data-line-number="9">sibsp           Number of Siblings<span class="op">/</span>Spouses Aboard</a>
<a class="sourceLine" id="cb440-10" data-line-number="10">parch           Number of Parents<span class="op">/</span>Children Aboard</a>
<a class="sourceLine" id="cb440-11" data-line-number="11">ticket          Ticket Number</a>
<a class="sourceLine" id="cb440-12" data-line-number="12">fare            Passenger Fare</a>
<a class="sourceLine" id="cb440-13" data-line-number="13">cabin           Cabin</a>
<a class="sourceLine" id="cb440-14" data-line-number="14">embarked        Port of Embarkation</a>
<a class="sourceLine" id="cb440-15" data-line-number="15">                (<span class="dt">C =</span> Cherbourg; <span class="dt">Q =</span> Queenstown; <span class="dt">S =</span> Southampton)</a>
<a class="sourceLine" id="cb440-16" data-line-number="16"></a>
<a class="sourceLine" id="cb440-17" data-line-number="17">SPECIAL NOTES<span class="op">:</span></a>
<a class="sourceLine" id="cb440-18" data-line-number="18">Pclass is a proxy <span class="cf">for</span> socio<span class="op">-</span>economic <span class="kw">status</span> (SES)</a>
<a class="sourceLine" id="cb440-19" data-line-number="19"> 1st <span class="op">~</span><span class="st"> </span>Upper; 2nd <span class="op">~</span><span class="st"> </span>Middle; 3rd <span class="op">~</span><span class="st"> </span>Lower</a>
<a class="sourceLine" id="cb440-20" data-line-number="20"></a>
<a class="sourceLine" id="cb440-21" data-line-number="21">Age is <span class="cf">in</span> Years; Fractional <span class="cf">if</span> Age less than <span class="kw">One</span> (<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb440-22" data-line-number="22"> If the Age is Estimated, it is <span class="cf">in</span> the form xx<span class="fl">.5</span></a>
<a class="sourceLine" id="cb440-23" data-line-number="23"></a>
<a class="sourceLine" id="cb440-24" data-line-number="24">With respect to the family relation <span class="kw">variables</span> (i.e. sibsp and parch)</a>
<a class="sourceLine" id="cb440-25" data-line-number="25">some relations were ignored.  The following are the definitions used</a>
<a class="sourceLine" id="cb440-26" data-line-number="26"><span class="cf">for</span> sibsp and parch.</a>
<a class="sourceLine" id="cb440-27" data-line-number="27"></a>
<a class="sourceLine" id="cb440-28" data-line-number="28">Sibling<span class="op">:</span><span class="st">  </span>Brother, Sister, Stepbrother, or Stepsister of Passenger Aboard Titanic</a>
<a class="sourceLine" id="cb440-29" data-line-number="29">Spouse<span class="op">:</span><span class="st">   </span>Husband or Wife of Passenger Aboard <span class="kw">Titanic</span> (Mistresses and Fiances Ignored)</a>
<a class="sourceLine" id="cb440-30" data-line-number="30">Parent<span class="op">:</span><span class="st">   </span>Mother or Father of Passenger Aboard Titanic</a>
<a class="sourceLine" id="cb440-31" data-line-number="31">Child<span class="op">:</span><span class="st">    </span>Son, Daughter, Stepson, or Stepdaughter of Passenger Aboard Titanic</a>
<a class="sourceLine" id="cb440-32" data-line-number="32"></a>
<a class="sourceLine" id="cb440-33" data-line-number="33">Other family relatives excluded from this study include cousins,</a>
<a class="sourceLine" id="cb440-34" data-line-number="34">nephews<span class="op">/</span>nieces, aunts<span class="op">/</span>uncles, and <span class="cf">in</span><span class="op">-</span>laws.  Some children travelled</a>
<a class="sourceLine" id="cb440-35" data-line-number="35">only with a nanny, therefore parch=<span class="dv">0</span> <span class="cf">for</span> them.  As well, some</a>
<a class="sourceLine" id="cb440-36" data-line-number="36">travelled with very close friends or neighbors <span class="cf">in</span> a village, however,</a>
<a class="sourceLine" id="cb440-37" data-line-number="37">the definitions do not support such relations.</a></code></pre></div>
<p>Sada kada dobro razumijemo naš podatkovni skup, možemo krenuti sa upoznavanjem funkcija paketa <code>dplyr</code>.</p>
</div>
<div id="stvaranje-podskupa-obzervacija-uz-filter-i-slice" class="section level2">
<h2><span class="header-section-number">11.2</span> Stvaranje podskupa obzervacija uz <code>filter</code> i <code>slice</code></h2>
<p>U poglavlju o podatkovnim okvirima smo već naučili da se “rezanje” podatkovnih okvira može raditi slično rezanju matrica - uz pomoć indeksnih vektora kojima definiramo koje retke/stupce zadržavamo. Isto tako, naučili smo da indeksni vektori mogu biti cjelobrojni (lokacijski), logički i imenski.</p>
<p>Kod definicije podskupa redaka daleko najčešći tip indeksnog vektora je logički - uz pomoć varijabli tj. stupaca definiramo određeni kriterij koji “filtrira” retke. Nažalost, osnovna <em>R</em>-ova sintaksa korištenja logičkih indeksnih redaka za određivanje podskupa redaka je ponešto nespretna, što se može vidjeti iz primjera:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb441-1" data-line-number="1">podaci[podaci<span class="op">$</span>a <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>podaci<span class="op">$</span>b <span class="op">!=</span><span class="st"> </span><span class="dv">3</span>, ]</a></code></pre></div>
<p>Prvi i očiti problem jest potreba ponavljanja imena podatkovnog okvira (koju možemo eliminirati uz pomoć funkcije <code>attach</code>, što smo rekli da nije idealno rješenje jer donosi niz novih potencijalnih problema). Drugo pitanje jest problem čitljivosti - gornju naredbu nije lako vizualno interpretirati, tj. naknadnim pregledom koda nije lako odmah uočiti da se radi o reduciranju broja redaka.</p>
<p>Funkcija <code>filter</code> eksplicitnom sintaksom odaje da se radi o filtriranju redaka, a također omogućuje korištenje imena stupaca bez potrebe za referenciranjem imena podatkovnog okvira:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" data-line-number="1"><span class="kw">filter</span>(podaci, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span><span class="dv">3</span>)</a></code></pre></div>
<p>Isto tako, dobro je uočiti da je prvi argument funkcije sam podatkovni skup, što nam omogućuje jednostavno ulančavanje. Na ovom principu dizajnirana je većina funkcija paketa <code>dplyr</code>.</p>
<p>Gore navedena funkcija predstavlja najčešći način odabira podskupa redaka (poznavatelji SQL-a uočiti će sličnost sa WHERE segmentom SQL upita). Pored funkcije filter, za određivanje podskupa redaka imamo i sljedeće funkcije, također vrlo intuitivnih imena (radi lakše interpretacije umjesto potpisa funkcija dajemo primjere parametara):</p>
<ul>
<li><code>distinct(podaci)</code> - za uklanjanje duplikata</li>
<li><code>slice(podaci, 1:10)</code> - za lokacijsko indeksiranje</li>
<li><code>sample_frac(podaci, 0.2)</code> - nasumični odabir dijela skupa po danom omjeru</li>
<li><code>sample_n(podaci, 50)</code> - nasumični odabir zadanog broja redaka</li>
<li><code>top_n(podaci, 10, a)</code> - prvih n redaka, gledano po poretku stupca a</li>
</ul>
<p>Za poredak redaka u ispisu možemo koristiti:</p>
<ul>
<li><code>arrange(podaci, a, desc(b))</code> - poredaj po stupcu <code>a</code> uzlazno pa po <code>b</code> silazno</li>
</ul>
<p>Isprobajmo ovo na primjerima:</p>
<hr />
<p><strong>Zadatak 11.3 - odabir redaka</strong></p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" data-line-number="1"><span class="co"># ispišite podatke o svim putnicima prve klase starijim od 60 godina</span></a>
<a class="sourceLine" id="cb443-2" data-line-number="2"></a>
<a class="sourceLine" id="cb443-3" data-line-number="3"><span class="co"># ispišite podatke o svim preživjelim muškim putnicima koji </span></a>
<a class="sourceLine" id="cb443-4" data-line-number="4"><span class="co"># u imenu imaju `George` ili `Frank`</span></a>
<a class="sourceLine" id="cb443-5" data-line-number="5"></a>
<a class="sourceLine" id="cb443-6" data-line-number="6"><span class="co"># provjerite ima li u podatkovnom skupu duplih obzervacija</span></a>
<a class="sourceLine" id="cb443-7" data-line-number="7"></a>
<a class="sourceLine" id="cb443-8" data-line-number="8"><span class="co"># nasumično izaberite i ispišite podatke o pet putnika koji nisu preživjeli potonuće</span></a>
<a class="sourceLine" id="cb443-9" data-line-number="9"><span class="co"># ispis poredati silazno po cijeni karte</span></a>
<a class="sourceLine" id="cb443-10" data-line-number="10"></a>
<a class="sourceLine" id="cb443-11" data-line-number="11"><span class="co"># ispišite podatke o pet najstarijih putnica prve klase </span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1"><span class="co"># ispišite podatke o svim putnicima prve klase starijim od 60 godina</span></a>
<a class="sourceLine" id="cb444-2" data-line-number="2"><span class="kw">filter</span>(titanic, Pclass <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>Age <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>)</a></code></pre></div>
<pre><code>## # A tibble: 14 x 12
##    PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##          &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1          55        0      1 Ostb~ male     65     0     1 113509  62.0
##  2          97        0      1 Gold~ male     71     0     0 PC 17~  34.7
##  3         171        0      1 Van ~ male     61     0     0 111240  33.5
##  4         253        0      1 Stea~ male     62     0     0 113514  26.6
##  5         276        1      1 Andr~ fema~    63     1     0 13502   78.0
##  6         439        0      1 Fort~ male     64     1     4 19950  263  
##  7         457        0      1 Mill~ male     65     0     0 13509   26.6
##  8         494        0      1 Arta~ male     71     0     0 PC 17~  49.5
##  9         546        0      1 Nich~ male     64     0     0 693     26  
## 10         556        0      1 Wrig~ male     62     0     0 113807  26.6
## 11         626        0      1 Sutt~ male     61     0     0 36963   32.3
## 12         631        1      1 Bark~ male     80     0     0 27042   30  
## 13         746        0      1 Cros~ male     70     1     1 WE/P ~  71  
## 14         830        1      1 Ston~ fema~    62     0     0 113572  80  
## # ... with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;chr&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" data-line-number="1"><span class="co"># ispišite podatke o svim preživjelim muškim putnicima koji </span></a>
<a class="sourceLine" id="cb446-2" data-line-number="2"><span class="co"># u imenu imaju `George` ili `Frank`</span></a>
<a class="sourceLine" id="cb446-3" data-line-number="3"><span class="kw">filter</span>(titanic, <span class="kw">str_detect</span>(Name, <span class="st">&quot;(George|Frank)&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>Sex <span class="op">==</span><span class="st"> &quot;male&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Survived)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 12
##   PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1         166        1      3 &quot;Gol~ male   9        0     2 363291  20.5
## 2         371        1      1 Hard~ male  25        1     0 11765   55.4
## 3         508        1      1 &quot;Bra~ male  NA        0     0 111427  26.6
## 4         571        1      2 Harr~ male  62        0     0 S.W./~  10.5
## 5         710        1      3 &quot;Mou~ male  NA        1     1 2661    15.2
## 6         832        1      2 Rich~ male   0.83     1     1 29106   18.8
## # ... with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;chr&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" data-line-number="1"><span class="co"># provjerite ima li u podatkovnom skupu duplih obzervacija</span></a>
<a class="sourceLine" id="cb448-2" data-line-number="2"><span class="kw">nrow</span>(titanic) <span class="op">==</span><span class="st"> </span><span class="kw">nrow</span>(<span class="kw">distinct</span>(titanic))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" data-line-number="1"><span class="co"># nasumično izaberite i ispišite podatke o pet putnika koji nisu preživjeli potonuće</span></a>
<a class="sourceLine" id="cb450-2" data-line-number="2"><span class="co"># ispis poredati silazno po cijeni karte</span></a>
<a class="sourceLine" id="cb450-3" data-line-number="3"><span class="kw">filter</span>(titanic, <span class="op">!</span>Survived) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Fare))</a></code></pre></div>
<pre><code>## # A tibble: 5 x 12
##   PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1         496        0      3 Yous~ male     NA     0     0 2627   14.5 
## 2         464        0      2 Mill~ male     48     0     0 234360 13   
## 3         869        0      3 van ~ male     NA     0     0 345777  9.5 
## 4          92        0      3 Andr~ male     20     0     0 347466  7.85
## 5          61        0      3 Sira~ male     22     0     0 2669    7.23
## # ... with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;chr&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" data-line-number="1"><span class="co"># ispišite podatke o pet najstarijih putnica prve klase </span></a>
<a class="sourceLine" id="cb452-2" data-line-number="2"><span class="kw">filter</span>(titanic, Pclass <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>Sex <span class="op">==</span><span class="st"> &quot;female&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">5</span>, Age) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Age)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 12
##   PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1          12        1      1 Bonn~ fema~    58     0     0 113783  26.6
## 2         196        1      1 Lure~ fema~    58     0     0 PC 17~ 147. 
## 3         269        1      1 Grah~ fema~    58     0     1 PC 17~ 153. 
## 4         367        1      1 Warr~ fema~    60     1     0 110813  75.2
## 5         830        1      1 Ston~ fema~    62     0     0 113572  80  
## 6         276        1      1 Andr~ fema~    63     1     0 13502   78.0
## # ... with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;chr&gt;</code></pre>
</div>
<hr />
<p>Uočite da “prvih n” redaka samo odabire podskup redaka, neće ga nužno ispisati po redu. Ukoliko želimo poredani ispis moramo koristiti i funkciju <code>arrange</code>.</p>
</div>
<div id="stvaranje-podskupa-varijabli-uz-select" class="section level2">
<h2><span class="header-section-number">11.3</span> Stvaranje podskupa varijabli uz <code>select</code></h2>
<p>Druga metoda rezanja podatkovnog okvira jest odabir podskupa stupaca. Za razliku od biranja podskupa redaka, gdje se najčešće služimo logičkim indeksiranjem tj. filtriranjem po određenom kriteriju, stupce tj. varijable najčešće referenciramo po njihovom imenu. Sintaksa odabira podskupa stupaca po imenu uz pomoć osnovnog načina indeksiranja u <em>R</em>-u izgleda na primjer ovako:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" data-line-number="1">podaci[, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)]</a></code></pre></div>
<p>Ovdje također uočavamo određenu nespretnost i teškoću interpretacije. Nazivi stupaca moraju biti ugrađeni u funkciju stvaranja vektora što smanjuje čitljivost, a naredba nigdje eksplicitno ne iskazuje da se radi o odabiru stupaca već do moramo zaključiti iz položaja indeksnog vektora. Dodatno, nema jednostavnog načina za odabir raspona stupaca po imenu, postojanju nekog podniza ili uzorka unutar imena i sl.</p>
<p>Funkcija <code>select</code> nam omogućuje eksplicitni odabir stupaca uz pomoć sintakse:</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb455-1" data-line-number="1"><span class="kw">select</span>(podaci, a, b, c)</a></code></pre></div>
<p>Dakle jednostavno navodimo podatkovni okvir i niz stupaca koje želimo odabrati. Ovdje je također lako uočiti sličnost sa SQL-om, konkretno SELECT segmentom SQL upita.</p>
<p>No gornja sintaksa nije sve što ova funkcija nudi - <code>select</code> ima čitav niz pomoćnih funkcija i operatora koji uvelike proširuju njezinu funkcionalnost, kao npr:</p>
<ul>
<li><code>select(podaci, a:c)</code> - odaberi stupce od <code>a</code> do <code>c</code></li>
<li><code>select(podaci, -a, -b)</code> - odaberi sve stupce osim <code>a</code> i <code>b</code></li>
<li><code>select(podaci, starts_with(&quot;PO&quot;)))</code> - odaberi stupce koji počinju sa slovima <code>&quot;PO&quot;</code></li>
<li><code>select(podaci, contains(&quot;stup&quot;))</code> - odaberi stupce koji sadrže podniz <code>&quot;stup&quot;</code></li>
<li><code>select(podaci, matches(&quot;[123]{2,3}&quot;))</code> - odaberi stupce koji odgovaraju danom regularnom izrazu</li>
</ul>
<p>Ovo nisu sve mogućnosti, no dodatne opcije lako je pronaći u službenoj dokumentaciji.</p>
<p>Isprobajmo ovu naredbu, također na podatkovnom skupu Titanic.</p>
<hr />
<p><strong>Zadatak 11.4 - funkcija <code>select</code></strong></p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb456-1" data-line-number="1"><span class="co"># za nasumično odabranih 10 redaka ispišite ime putnika, dob te </span></a>
<a class="sourceLine" id="cb456-2" data-line-number="2"><span class="co"># da li je preživio potonuće ili ne</span></a>
<a class="sourceLine" id="cb456-3" data-line-number="3"></a>
<a class="sourceLine" id="cb456-4" data-line-number="4"><span class="co"># za prvih 10 najstarijih putnika ispišite sve atribute od imena do cijene karte</span></a>
<a class="sourceLine" id="cb456-5" data-line-number="5"></a>
<a class="sourceLine" id="cb456-6" data-line-number="6"><span class="co"># za nasumično odabranih 1% redaka ispišite sve atribute osim identifikatora </span></a>
<a class="sourceLine" id="cb456-7" data-line-number="7"><span class="co"># putnika i broja kabine</span></a>
<a class="sourceLine" id="cb456-8" data-line-number="8"></a>
<a class="sourceLine" id="cb456-9" data-line-number="9"><span class="co"># za retke od broja 10 do broja 20 ispišite sve stupce koji počinju samoglasnikom</span></a>
<a class="sourceLine" id="cb456-10" data-line-number="10"></a>
<a class="sourceLine" id="cb456-11" data-line-number="11"><span class="co"># za nasumičnih 10 putnika koji imaju nepoznat broj godina ispišite sve </span></a>
<a class="sourceLine" id="cb456-12" data-line-number="12"><span class="co"># atribute od imena do cijene karte, </span></a>
<a class="sourceLine" id="cb456-13" data-line-number="13"><span class="co"># potom putničku klasu te konačno da li je putnik preživio ili ne</span></a>
<a class="sourceLine" id="cb456-14" data-line-number="14"><span class="co"># poredajte ispis abecedno po imenu</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb457-1" data-line-number="1"><span class="co"># za nasumično odabranih 10 redaka ispišite ime putnika, dob te</span></a>
<a class="sourceLine" id="cb457-2" data-line-number="2"><span class="co"># da li je preživio potonuće ili ne</span></a>
<a class="sourceLine" id="cb457-3" data-line-number="3"><span class="kw">sample_n</span>(titanic, <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Name, Age, Survived)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    Name                                                       Age Survived
##    &lt;chr&gt;                                                    &lt;dbl&gt;    &lt;int&gt;
##  1 Panula, Mrs. Juha (Maria Emilia Ojala)                   41           0
##  2 Taussig, Miss. Ruth                                      18           1
##  3 Sirayanian, Mr. Orsen                                    22           0
##  4 Lemore, Mrs. (Amelia Milley)                             34           1
##  5 Hamalainen, Master. Viljo                                 0.67        1
##  6 Sandstrom, Miss. Marguerite Rut                           4           1
##  7 Baclini, Miss. Marie Catherine                            5           1
##  8 Stead, Mr. William Thomas                                62           0
##  9 Penasco y Castellana, Mrs. Victor de Satode (Maria Jose~ 17           1
## 10 Hassan, Mr. Houssein G N                                 11           0</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb459-1" data-line-number="1"><span class="co"># za prvih 10 najstarijih putnika ispišite sve atribute od imena do cijene karte</span></a>
<a class="sourceLine" id="cb459-2" data-line-number="2"><span class="kw">top_n</span>(titanic, <span class="dv">10</span>, Age) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Name<span class="op">:</span>Fare)</a></code></pre></div>
<pre><code>## # A tibble: 11 x 7
##    Name                            Sex     Age SibSp Parch Ticket     Fare
##    &lt;chr&gt;                           &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 Wheadon, Mr. Edward H           male   66       0     0 C.A. 245~ 10.5 
##  2 Ostby, Mr. Engelhart Cornelius  male   65       0     1 113509    62.0 
##  3 Goldschmidt, Mr. George B       male   71       0     0 PC 17754  34.7 
##  4 Connors, Mr. Patrick            male   70.5     0     0 370369     7.75
##  5 Duane, Mr. Frank                male   65       0     0 336439     7.75
##  6 Millet, Mr. Francis Davis       male   65       0     0 13509     26.6 
##  7 Artagaveytia, Mr. Ramon         male   71       0     0 PC 17609  49.5 
##  8 Barkworth, Mr. Algernon Henry ~ male   80       0     0 27042     30   
##  9 Mitchell, Mr. Henry Michael     male   70       0     0 C.A. 245~ 10.5 
## 10 Crosby, Capt. Edward Gifford    male   70       1     1 WE/P 5735 71   
## 11 Svensson, Mr. Johan             male   74       0     0 347060     7.78</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb461-1" data-line-number="1"><span class="co"># za nasumično odabranih 1% redaka ispišite sve atribute osim identifikatora </span></a>
<a class="sourceLine" id="cb461-2" data-line-number="2"><span class="co"># putnika i broja kabine</span></a>
<a class="sourceLine" id="cb461-3" data-line-number="3"><span class="kw">sample_frac</span>(titanic, <span class="fl">0.01</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>PassengerId, <span class="op">-</span>Cabin)</a></code></pre></div>
<pre><code>## # A tibble: 9 x 10
##   Survived Pclass Name       Sex     Age SibSp Parch Ticket  Fare Embarked
##      &lt;int&gt;  &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   
## 1        0      3 Thorneycr~ male     NA     1     0 376564 16.1  S       
## 2        1      3 Nilsson, ~ fema~    26     0     0 347470  7.85 S       
## 3        1      2 Faunthorp~ fema~    29     1     0 2926   26    S       
## 4        1      3 Jansson, ~ male     21     0     0 350034  7.80 S       
## 5        0      2 Eitemille~ male     23     0     0 29751  13    S       
## 6        0      3 Sdycoff, ~ male     NA     0     0 349222  7.90 S       
## 7        1      2 Davies, M~ male      8     1     1 C.A. ~ 36.8  S       
## 8        0      3 Reed, Mr.~ male     NA     0     0 362316  7.25 S       
## 9        1      2 Leitch, M~ fema~    NA     0     0 248727 33    S</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb463-1" data-line-number="1"><span class="co"># za retke od broja 10 do broja 20 ispišite sve stupce koji počinju samoglasnikom</span></a>
<a class="sourceLine" id="cb463-2" data-line-number="2"><span class="kw">slice</span>(titanic, <span class="dv">10</span><span class="op">:</span><span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;^[AEIOU]&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 11 x 2
##      Age Embarked
##    &lt;dbl&gt; &lt;chr&gt;   
##  1    14 C       
##  2     4 S       
##  3    58 S       
##  4    20 S       
##  5    39 S       
##  6    14 S       
##  7    55 S       
##  8     2 Q       
##  9    NA S       
## 10    31 S       
## 11    NA C</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb465-1" data-line-number="1"><span class="co"># za nasumičnih 10 putnika koji imaju nepoznat broj godina ispišite sve </span></a>
<a class="sourceLine" id="cb465-2" data-line-number="2"><span class="co"># atribute od imena do cijene karte, </span></a>
<a class="sourceLine" id="cb465-3" data-line-number="3"><span class="co"># potom putničku klasu te konačno da li je putnik preživio ili ne</span></a>
<a class="sourceLine" id="cb465-4" data-line-number="4"><span class="co"># poredajte ispis abecedno po imenu</span></a>
<a class="sourceLine" id="cb465-5" data-line-number="5"><span class="kw">filter</span>(titanic, <span class="kw">is.na</span>(Age)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb465-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(Name<span class="op">:</span>Fare, Pclass, Survived) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Name)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 9
##    Name              Sex      Age SibSp Parch Ticket  Fare Pclass Survived
##    &lt;chr&gt;             &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;int&gt;    &lt;int&gt;
##  1 Boulos, Mr. Hanna male      NA     0     0 2664    7.22      3        0
##  2 Klaber, Mr. Herm~ male      NA     0     0 113028 26.6       1        0
##  3 Lennon, Mr. Denis male      NA     1     0 370371 15.5       3        0
##  4 &quot;O&#39;Dwyer, Miss. ~ female    NA     0     0 330959  7.88      3        1
##  5 Peter, Miss. Anna female    NA     1     1 2668   22.4       3        1
##  6 Peters, Miss. Ka~ female    NA     0     0 330935  8.14      3        0
##  7 Plotcharsky, Mr.~ male      NA     0     0 349227  7.90      3        0
##  8 Razi, Mr. Raihed  male      NA     0     0 2629    7.23      3        0
##  9 Sage, Mr. Freder~ male      NA     8     2 CA. 2~ 69.6       3        0
## 10 Zabour, Miss. Th~ female    NA     1     0 2665   14.5       3        0</code></pre>
</div>
<hr />
</div>
<div id="stvaranje-novih-stupaca-uz-mutate" class="section level2">
<h2><span class="header-section-number">11.4</span> Stvaranje novih stupaca uz <code>mutate</code></h2>
<p>U radu sa podatkovnim skupovima često se pojavi potreba za stvaranjem dodatnih varijabli uz pomoć informacija pohranjenih u jednoj ili više postojećih varijabli. Novi stupac najčešće stvaramo uz pomoć nekog izraza koji opisuje na koji način transformiramo postojeće podatke; motivacija može biti normalizacija numeričke varijable, stvaranje indikatorske ili kategorijske varijable, sumiranje više varijabli u jednu jedinstvenu varijablu ili bilo koja druga transformacija s ciljem dobivanja nove varijable koja je na neki način potrebna za daljnji proces analize.</p>
<p>Ako pretpostavimo stvaranje novog stupca koji će pohraniti zbroj numeričkih vrijednosti postojećih stupaca, onda bi uz pomoć osnovnih funkcija <em>R</em>-a to proveli na sljedeći način:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb467-1" data-line-number="1">podaci<span class="op">$</span>c &lt;-<span class="st"> </span>podaci<span class="op">$</span>a <span class="op">+</span><span class="st"> </span>podaci<span class="op">$</span>b</a></code></pre></div>
<p>Paket <code>dplyr</code> nam nudi alternativu u obliku funkcija <code>mutate</code> i <code>transmute</code>:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb468-1" data-line-number="1"><span class="kw">mutate</span>(podaci, <span class="dt">c =</span> a <span class="op">+</span><span class="st"> </span>b)</a>
<a class="sourceLine" id="cb468-2" data-line-number="2"></a>
<a class="sourceLine" id="cb468-3" data-line-number="3"><span class="kw">transmute</span>(podaci, <span class="dt">c =</span> a <span class="op">+</span><span class="st"> </span>b)</a></code></pre></div>
<p>Razlika: <code>mutate</code> vraća cijeli originalni podatkovni okvir uz novostvorene stupce, dok <code>transmute</code> zadržava samo one koje smo naveli unutar poziva funkcije. Zbog toga <code>transmute</code> možemo koristiti kao skraćenu kombinaciju <code>mutate</code> i <code>select</code>, npr:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb469-1" data-line-number="1"><span class="kw">transmute</span>(podaci, a, <span class="dt">c =</span> a <span class="op">+</span><span class="st"> </span>b)</a>
<a class="sourceLine" id="cb469-2" data-line-number="2"><span class="co"># isto kao i mutate(podaci, c = a + b) %&gt;% select(a, c)</span></a></code></pre></div>
<p>(NAPOMENA: Ovdje se ne moramo bojati degradacije performansi zbog kopiranja okvira, budući da <em>R</em> kod dodavanja stupca radi “plitku kopiju” (<em>shallow copy</em>), tj. novi okvir samo referencira novi stupac dok dijeli reference na preostale stupce sa “originalnim” okvirom. “Duboka kopija” (<em>deep copy</em>) bi značilo da se svi stupci kopiraju u potpuno novi okvir, u kojem slučaju bi ova operacija bila resursno “skupa”)</p>
<p>Uočite da <code>mutate</code> i <code>transmute</code> nisu alternative naredbi <em>UPDATE</em> iz <em>SQL</em>-a, već zapravo odgovaraju <em>SELECT</em> segmentu naredbe u scenarijima kada ne biramo pojedine stupce već ih kombiniramo u sklopu izraza.</p>
<p>Funkcije <code>mutate</code> i <code>transmute</code> koriste uobičajene (vektorizirane) funkcije i operatore, a imamo na raspolaganju i niz dodatnih tzv. “prozorskih” (<em>window</em>) funkcija koje nam omogućuju dodatnu fleksibilnost kod stvaranja novih varijabli, kao npr:</p>
<ul>
<li><code>ntile</code>, <code>cut</code> - stvaranje kategorijske varijable koja grupira vrijednosti u <code>n</code> ladica; <code>ntile</code> će napraviti kategorije jednake veličine, dok će <code>cut</code> rezati u ovisnosti o veličini intervala numeričkih vrijednosti</li>
<li><code>dense_rank</code>, <code>min_rank</code> - rangiranje obzervacija (razlika je samo u tretiranju obzervacija sa istim vrijednostima)</li>
<li><code>between</code> - opisuje da li je varijabla nekog stupca u intervalu zadanom sa dva druga stupca</li>
<li><code>pmin</code>, <code>pmax</code> - “paralelni minimum i maksimum”, tj. minimum ili maksimum vrijednosti odabranih stupaca gledano po retcima</li>
<li>itd.</li>
</ul>
<p>Popis svih dostupnih funkcija može se pronaći u dokumentaciji.</p>
<hr />
<p><strong>Zadatak 11.5 - funkcija <code>mutate</code></strong></p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb470-1" data-line-number="1"><span class="co"># tablici `titanic` dodajte logički stupac `hadRelativesOnBoard` koji će opisivati</span></a>
<a class="sourceLine" id="cb470-2" data-line-number="2"><span class="co"># da li je putnik imao rodbine na brodu</span></a>
<a class="sourceLine" id="cb470-3" data-line-number="3"></a>
<a class="sourceLine" id="cb470-4" data-line-number="4"></a>
<a class="sourceLine" id="cb470-5" data-line-number="5"><span class="co"># za nasumičnih 10 putnica starijih od 20 godina koje su se ukrcale u Southamptonu</span></a>
<a class="sourceLine" id="cb470-6" data-line-number="6"><span class="co"># ispišite ime putnice, putničku klasu i prilagođenu cijenu karte</span></a>
<a class="sourceLine" id="cb470-7" data-line-number="7"><span class="co"># cijenu karte zamijenite odgovarajućom cijenom koliko bi ona iznosila danas</span></a>
<a class="sourceLine" id="cb470-8" data-line-number="8"><span class="co">#   (pretpostavite da je $1 iz 1912. jednak današnjih $23.85, uračunavajući inflaciju)</span></a>
<a class="sourceLine" id="cb470-9" data-line-number="9"><span class="co"># novi stupac nazovite `FareToday` a </span></a>
<a class="sourceLine" id="cb470-10" data-line-number="10"><span class="co"># iznos zaokružite na dvije decimale i dodajte prefiks `$`</span></a>
<a class="sourceLine" id="cb470-11" data-line-number="11"><span class="co"># ispis poredajte po putničkoj klasi silazno</span></a>
<a class="sourceLine" id="cb470-12" data-line-number="12"></a>
<a class="sourceLine" id="cb470-13" data-line-number="13"></a>
<a class="sourceLine" id="cb470-14" data-line-number="14"><span class="co"># stvorite stupac FareCategory kojim ćete podijeliti cijene karata </span></a>
<a class="sourceLine" id="cb470-15" data-line-number="15"><span class="co"># u pet kategorija jednake veličine</span></a>
<a class="sourceLine" id="cb470-16" data-line-number="16"><span class="co"># potom nasumično izaberite 20 putnika i ispišite </span></a>
<a class="sourceLine" id="cb470-17" data-line-number="17"><span class="co"># ime putnika, putničku klasu, cijenu karte i kategoriju</span></a>
<a class="sourceLine" id="cb470-18" data-line-number="18"><span class="co"># ispis poredajte po kategoriji cijene</span></a>
<a class="sourceLine" id="cb470-19" data-line-number="19"></a>
<a class="sourceLine" id="cb470-20" data-line-number="20"></a>
<a class="sourceLine" id="cb470-21" data-line-number="21"><span class="co"># tablici `titanic` dodajte stupac `EmbarkationPort` u kojem će pisati puno </span></a>
<a class="sourceLine" id="cb470-22" data-line-number="22"><span class="co"># ime luke ukrcaja (Southampton, Queenstown ili Cherbourg)</span></a>
<a class="sourceLine" id="cb470-23" data-line-number="23"><span class="co"># koristite `mutate` i dva `ifelse`</span></a>
<a class="sourceLine" id="cb470-24" data-line-number="24"></a>
<a class="sourceLine" id="cb470-25" data-line-number="25"></a>
<a class="sourceLine" id="cb470-26" data-line-number="26"><span class="co"># ispišite prvih 10 redaka tablice `titanic`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb471-1" data-line-number="1"><span class="co"># tablici `titanic` dodajte logički stupac `hadRelativesOnBoard` koji će opisivati</span></a>
<a class="sourceLine" id="cb471-2" data-line-number="2"><span class="co"># da li je putnik imao rodbine na brodu</span></a>
<a class="sourceLine" id="cb471-3" data-line-number="3">titanic &lt;-<span class="st"> </span><span class="kw">mutate</span>(titanic, <span class="dt">hadRelativesOnBoard =</span> SibSp <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>Parch <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a></code></pre></div>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1"><span class="co"># za nasumičnih 10 putnica starijih od 20 godina koje su se ukrcale u Southamptonu</span></a>
<a class="sourceLine" id="cb472-2" data-line-number="2"><span class="co"># ispišite ime putnice, putničku klasu i prilagođenu cijenu karte</span></a>
<a class="sourceLine" id="cb472-3" data-line-number="3"><span class="co"># cijenu karte zamijenite odgovarajućom cijenom koliko bi ona iznosila danas</span></a>
<a class="sourceLine" id="cb472-4" data-line-number="4"><span class="co">#   (pretpostavite da je $1 iz 1912. jednak današnjih $23.85, uračunavajući inflaciju)</span></a>
<a class="sourceLine" id="cb472-5" data-line-number="5"><span class="co"># novi stupac nazovite `FareToday` a iznos zaokružite na dvije decimale i dodajte prefiks `$`</span></a>
<a class="sourceLine" id="cb472-6" data-line-number="6"><span class="co"># ispis poredajte po putničkoj klasi silazno</span></a>
<a class="sourceLine" id="cb472-7" data-line-number="7"></a>
<a class="sourceLine" id="cb472-8" data-line-number="8"><span class="kw">filter</span>(titanic, Sex <span class="op">==</span><span class="st"> &#39;female&#39;</span>, Age <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>,  Embarked <span class="op">==</span><span class="st"> &#39;S&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb472-9" data-line-number="9"><span class="kw">transmute</span>(Name, Pclass, <span class="dt">FareToday =</span> <span class="kw">str_c</span>(<span class="st">&quot;$&quot;</span>, <span class="kw">round</span>(Fare <span class="op">*</span><span class="st"> </span><span class="fl">23.85</span>, <span class="dv">2</span>))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Pclass))</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    Name                                                Pclass FareToday
##    &lt;chr&gt;                                                &lt;int&gt; &lt;chr&gt;    
##  1 &quot;Ford, Miss. Doolina Margaret \&quot;Daisy\&quot;&quot;                 3 $819.84  
##  2 Sandstrom, Mrs. Hjalmar (Agnes Charlotta Bengtsson)      3 $398.3   
##  3 Panula, Mrs. Juha (Maria Emilia Ojala)                   3 $946.55  
##  4 Jussila, Miss. Mari Aina                                 3 $234.33  
##  5 Stanley, Miss. Amy Zillah Elsie                          3 $180.07  
##  6 Honkanen, Miss. Eliina                                   3 $189.01  
##  7 Nilsson, Miss. Helmina Josefina                          3 $187.32  
##  8 Davis, Miss. Mary                                        2 $310.05  
##  9 Leader, Dr. Alice (Farnham)                              1 $618.41  
## 10 Carter, Mrs. William Ernest (Lucile Polk)                1 $2862</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1"><span class="co"># stvorite stupac FareCategory kojim ćete podijeliti cijene karata </span></a>
<a class="sourceLine" id="cb474-2" data-line-number="2"><span class="co"># u pet kategorija jednake veličine</span></a>
<a class="sourceLine" id="cb474-3" data-line-number="3"><span class="co"># potom nasumično izaberite 20 putnika i ispišite </span></a>
<a class="sourceLine" id="cb474-4" data-line-number="4"><span class="co"># ime putnika, putničku klasu, cijenu karte i kategoriju</span></a>
<a class="sourceLine" id="cb474-5" data-line-number="5"><span class="co"># ispis poredajte po kategoriji cijene</span></a>
<a class="sourceLine" id="cb474-6" data-line-number="6"></a>
<a class="sourceLine" id="cb474-7" data-line-number="7"><span class="kw">mutate</span>(titanic, <span class="dt">FareCategory =</span> <span class="kw">ntile</span>(Fare, <span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb474-8" data-line-number="8"><span class="kw">select</span>(Name, Pclass, Fare, FareCategory) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(FareCategory)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 4
##    Name                                         Pclass   Fare FareCategory
##    &lt;chr&gt;                                         &lt;int&gt;  &lt;dbl&gt;        &lt;int&gt;
##  1 Charters, Mr. David                               3   7.73            1
##  2 Connolly, Miss. Kate                              3   7.75            1
##  3 Connaghton, Mr. Michael                           3   7.75            1
##  4 Youseff, Mr. Gerious                              3   7.22            1
##  5 Lemore, Mrs. (Amelia Milley)                      2  10.5             2
##  6 Lievens, Mr. Rene Aime                            3   9.5             2
##  7 Larsson, Mr. August Viktor                        3   9.48            2
##  8 Meyer, Mr. August                                 2  13               3
##  9 Lindell, Mr. Edvard Bengtsson                     3  15.6             3
## 10 Jerwan, Mrs. Amin S (Marie Marthe Thuillard)      2  13.8             3
## 11 Chapman, Mr. Charles Henry                        2  13.5             3
## 12 Blackwell, Mr. Stephen Weart                      1  35.5             4
## 13 Moran, Miss. Bertha                               3  24.2             4
## 14 Collyer, Mrs. Harvey (Charlotte Annie Tate)       2  26.2             4
## 15 Chip, Mr. Chang                                   3  56.5             5
## 16 Chaffee, Mr. Herbert Fuller                       1  61.2             5
## 17 Bissette, Miss. Amelia                            1 136.              5
## 18 Endres, Miss. Caroline Louise                     1 228.              5
## 19 Allison, Mrs. Hudson J C (Bessie Waldo Dani~      1 152.              5
## 20 Carter, Master. William Thornton II               1 120               5</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1"><span class="co"># tablici `titanic` dodajte stupac `EmbarkationPort` u kojem će pisati puno ime luke ukrcaja</span></a>
<a class="sourceLine" id="cb476-2" data-line-number="2"><span class="co">#   (Southampton, Queenstown ili Cherbourg)</span></a>
<a class="sourceLine" id="cb476-3" data-line-number="3"><span class="co"># koristite `mutate` i dva `ifelse`</span></a>
<a class="sourceLine" id="cb476-4" data-line-number="4"><span class="kw">mutate</span>(titanic, <span class="dt">EmbarkationPort =</span> <span class="kw">ifelse</span>(Embarked <span class="op">==</span><span class="st"> &#39;S&#39;</span>, <span class="st">&#39;Southampton&#39;</span>, </a>
<a class="sourceLine" id="cb476-5" data-line-number="5">            <span class="kw">ifelse</span>(Embarked <span class="op">==</span><span class="st"> &#39;C&#39;</span>, <span class="st">&#39;Cherbourg&#39;</span>, <span class="st">&#39;Queenstown&#39;</span>))) -&gt;<span class="st"> </span>titanic</a>
<a class="sourceLine" id="cb476-6" data-line-number="6"></a>
<a class="sourceLine" id="cb476-7" data-line-number="7"><span class="co"># ispišite prvih 10 redaka tablice `titanic`</span></a>
<a class="sourceLine" id="cb476-8" data-line-number="8"><span class="kw">head</span>(titanic, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 14
##    PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##          &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1           1        0      3 Brau~ male     22     1     0 A/5 2~  7.25
##  2           2        1      1 Cumi~ fema~    38     1     0 PC 17~ 71.3 
##  3           3        1      3 Heik~ fema~    26     0     0 STON/~  7.92
##  4           4        1      1 Futr~ fema~    35     1     0 113803 53.1 
##  5           5        0      3 Alle~ male     35     0     0 373450  8.05
##  6           6        0      3 Mora~ male     NA     0     0 330877  8.46
##  7           7        0      1 McCa~ male     54     0     0 17463  51.9 
##  8           8        0      3 Pals~ male      2     3     1 349909 21.1 
##  9           9        1      3 John~ fema~    27     0     2 347742 11.1 
## 10          10        1      2 Nass~ fema~    14     1     0 237736 30.1 
## # ... with 4 more variables: Cabin &lt;chr&gt;, Embarked &lt;chr&gt;,
## #   hadRelativesOnBoard &lt;lgl&gt;, EmbarkationPort &lt;chr&gt;</code></pre>
</div>
</div>
<div id="ogledni-podatkovni-skup-houston-flights" class="section level2">
<h2><span class="header-section-number">11.5</span> Ogledni podatkovni skup: <em>Houston flights</em></h2>
<p>Učitajmo paket <code>dplyr</code> i podatkovni okvir <code>hflights</code> koji se nalazi u paketu istog imena i može ga se dohvatiti iz CRAN repozitorija. Nakon učitavanja paketa podatkovni okvir možemo prebaciti u globalnu okolinu uz pomoć funkcije <code>data</code>.</p>
<hr />
<p><strong>Zadatak 11.6 - podatkovni skup <code>hflights</code></strong></p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" data-line-number="1"><span class="co"># učitajte paket `hflights`</span></a>
<a class="sourceLine" id="cb478-2" data-line-number="2"><span class="co"># ukoliko je potrebno instalirajte ga sa CRAN repozitorija</span></a>
<a class="sourceLine" id="cb478-3" data-line-number="3"><span class="co"># uz pomoć funkcije `data` učitajte okvir u globalnu okolinu</span></a>
<a class="sourceLine" id="cb478-4" data-line-number="4"></a>
<a class="sourceLine" id="cb478-5" data-line-number="5"><span class="co"># pretvorite okvir u `hflights` u klasu `tbl`</span></a>
<a class="sourceLine" id="cb478-6" data-line-number="6"></a>
<a class="sourceLine" id="cb478-7" data-line-number="7"><span class="co"># upoznajte se s podatkovnim skupom `hflights`</span></a>
<a class="sourceLine" id="cb478-8" data-line-number="8"><span class="co"># pored funkcija glimpse/head/itd. možete pogledati i dokumentaciju</span></a>
<a class="sourceLine" id="cb478-9" data-line-number="9"><span class="co"># skupa uz pomoć naredbe `?hflights`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb479-1" data-line-number="1"><span class="co">#install.packages(&quot;hflights&quot;)  # ukoliko je potrebno</span></a>
<a class="sourceLine" id="cb479-2" data-line-number="2"><span class="co">#library(dplyr)               # ako već nisu učitani</span></a>
<a class="sourceLine" id="cb479-3" data-line-number="3"><span class="co">#library(hflights)             </span></a>
<a class="sourceLine" id="cb479-4" data-line-number="4"><span class="kw">data</span>(hflights)</a>
<a class="sourceLine" id="cb479-5" data-line-number="5"></a>
<a class="sourceLine" id="cb479-6" data-line-number="6">hflights &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(hflights)</a>
<a class="sourceLine" id="cb479-7" data-line-number="7"></a>
<a class="sourceLine" id="cb479-8" data-line-number="8"><span class="kw">glimpse</span>(hflights)</a>
<a class="sourceLine" id="cb479-9" data-line-number="9"><span class="kw">head</span>(hflights)</a></code></pre></div>
<pre><code>## Observations: 227,496
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ DayofMonth        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1...
## $ DayOfWeek         &lt;int&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6,...
## $ DepTime           &lt;int&gt; 1400, 1401, 1352, 1403, 1405, 1359, 1359, 13...
## $ ArrTime           &lt;int&gt; 1500, 1501, 1502, 1513, 1507, 1503, 1509, 14...
## $ UniqueCarrier     &lt;chr&gt; &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;A...
## $ FlightNum         &lt;int&gt; 428, 428, 428, 428, 428, 428, 428, 428, 428,...
## $ TailNum           &lt;chr&gt; &quot;N576AA&quot;, &quot;N557AA&quot;, &quot;N541AA&quot;, &quot;N403AA&quot;, &quot;N49...
## $ ActualElapsedTime &lt;int&gt; 60, 60, 70, 70, 62, 64, 70, 59, 71, 70, 70, ...
## $ AirTime           &lt;int&gt; 40, 45, 48, 39, 44, 45, 43, 40, 41, 45, 42, ...
## $ ArrDelay          &lt;int&gt; -10, -9, -8, 3, -3, -7, -1, -16, 44, 43, 29,...
## $ DepDelay          &lt;int&gt; 0, 1, -8, 3, 5, -1, -1, -5, 43, 43, 29, 19, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;D...
## $ Distance          &lt;int&gt; 224, 224, 224, 224, 224, 224, 224, 224, 224,...
## $ TaxiIn            &lt;int&gt; 7, 6, 5, 9, 9, 6, 12, 7, 8, 6, 8, 4, 6, 5, 6...
## $ TaxiOut           &lt;int&gt; 13, 9, 17, 22, 9, 13, 15, 12, 22, 19, 20, 11...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## # A tibble: 6 x 21
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1  2011     1          1         6    1400    1500 AA                  428
## 2  2011     1          2         7    1401    1501 AA                  428
## 3  2011     1          3         1    1352    1502 AA                  428
## 4  2011     1          4         2    1403    1513 AA                  428
## 5  2011     1          5         3    1405    1507 AA                  428
## 6  2011     1          6         4    1359    1503 AA                  428
## # ... with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;,
## #   Dest &lt;chr&gt;, Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;,
## #   Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;</code></pre>
</div>
<hr />
</div>
<div id="grupiranje-i-agregacija-uz-group_by-i-summarise" class="section level2">
<h2><span class="header-section-number">11.6</span> Grupiranje i agregacija uz <code>group_by</code> i <code>summarise</code></h2>
<p>U literaturi koja se bavi analizom podataka često ćemo naići na tzv. SAC paradigmu (engl. <em>Split-Apply-Combine</em>). Radi se o strategiji koja se svodi na rastavljanje velikog zadatka na manje dijelove, obavljanje određenog posla na svakom od dijelova te konačno kombiniranje svih rezultata u jedinstvenu cjelinu. Potrebu za ovom paradigmom nailazimo u različitim scenarijima analize - u eksploratornoj analizi podataka htjet ćemo izračunati različite statistike ili stvoriti nove varijable zasebno za različite podskupove podataka (npr. ovisno o nekoj kategorijskoj varijabli); kod obrade iznimno velikih količina podataka često želimo ubrzati proces obrade na način da podatke razbijemo u manje skupove koji će se svaki obrađivati zasebno (poznati princip <em>Map-Reduce</em>).</p>
<p>Poznavatelji <em>SQL</em>-a će ovaj princip lako prepoznati kao grupiranje i agregaciju koji se provode kroz <em>GROUP BY</em> segment <em>SQL</em> upita uz prateće elemente u <em>SELECT</em> dijelu. Paket <code>dplyr</code> nudi vrlo sličnu funkcionalnost (iako na proceduralni način) - prvo provedemo “grupiranje”, tj. stvaranje podskupova redaka nekog okvira, a onda provodimo daljnje obrade paralelno nad svakim podskupom, da bi na kraju sve rezultate sakupili u jedinstveni podatkovni okvir.</p>
<p>Za grupiranje <code>dplyr</code> nudi funkciju <code>group_by</code> kojom tablicu (podatkovni okvir) pretvaramo u “grupiranu tablicu” (<code>grouped_tbl</code>):</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" data-line-number="1"><span class="kw">group_by</span>(podaci, a, b, c)</a></code></pre></div>
<p>Isprobajmo ovu funkciju na našem okviru <code>hflights</code>.</p>
<hr />
<p><strong>Zadatak 11.7 - grupirana tablica</strong></p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" data-line-number="1"><span class="co"># stvorite varijablu `flight815` koja će sadržavati retke iz tablice `hflights`</span></a>
<a class="sourceLine" id="cb482-2" data-line-number="2"><span class="co"># vezane uz let broj 815</span></a>
<a class="sourceLine" id="cb482-3" data-line-number="3"></a>
<a class="sourceLine" id="cb482-4" data-line-number="4"><span class="co"># stvorite varijablu `grouped815` koja će sadržavati retke iz `flight815`</span></a>
<a class="sourceLine" id="cb482-5" data-line-number="5"><span class="co"># grupirane po mjesecu</span></a>
<a class="sourceLine" id="cb482-6" data-line-number="6"></a>
<a class="sourceLine" id="cb482-7" data-line-number="7"><span class="co"># provjerite klasu varijabli `flight815` i `grouped815`</span></a>
<a class="sourceLine" id="cb482-8" data-line-number="8"></a>
<a class="sourceLine" id="cb482-9" data-line-number="9"></a>
<a class="sourceLine" id="cb482-10" data-line-number="10"><span class="co"># uz pomoć funkcije `glimpse` pogledajte strukture varijabli `flight815` i `grouped815`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb483-1" data-line-number="1"><span class="co"># stvorite varijablu `flight815` koja će sadržavati retke iz tablice `hflights`</span></a>
<a class="sourceLine" id="cb483-2" data-line-number="2"><span class="co"># vezane uz let broj 815</span></a>
<a class="sourceLine" id="cb483-3" data-line-number="3">flight815 &lt;-<span class="st"> </span><span class="kw">filter</span>(hflights, FlightNum <span class="op">==</span><span class="st"> </span><span class="dv">815</span>) </a>
<a class="sourceLine" id="cb483-4" data-line-number="4"></a>
<a class="sourceLine" id="cb483-5" data-line-number="5"><span class="co"># stvorite varijablu `grouped815` koja će sadržavati retke iz `flight815`</span></a>
<a class="sourceLine" id="cb483-6" data-line-number="6"><span class="co"># grupirane po mjesecu</span></a>
<a class="sourceLine" id="cb483-7" data-line-number="7">grouped815 &lt;-<span class="st"> </span><span class="kw">group_by</span>(flight815, Month)</a>
<a class="sourceLine" id="cb483-8" data-line-number="8"></a>
<a class="sourceLine" id="cb483-9" data-line-number="9"><span class="co"># provjerite klasu varijabli `flight815` i `grouped815`</span></a>
<a class="sourceLine" id="cb483-10" data-line-number="10"><span class="kw">class</span>(flight815)</a>
<a class="sourceLine" id="cb483-11" data-line-number="11"><span class="kw">class</span>(grouped815)</a></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;
## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb485-1" data-line-number="1"><span class="co"># uz pomoć funkcije `glimpse` pogledajte strukture varijabli `flight815` i `grouped815`</span></a>
<a class="sourceLine" id="cb485-2" data-line-number="2"><span class="kw">glimpse</span>(flight815)</a>
<a class="sourceLine" id="cb485-3" data-line-number="3"><span class="kw">print</span>(<span class="st">&quot;------------------------&quot;</span>)  <span class="co"># radi preglednijeg ispisa na konzoli</span></a>
<a class="sourceLine" id="cb485-4" data-line-number="4"><span class="kw">glimpse</span>(grouped815)</a></code></pre></div>
<pre><code>## Observations: 95
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,...
## $ DayofMonth        &lt;int&gt; 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, ...
## $ DayOfWeek         &lt;int&gt; 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3, 2, 1, 7, 6,...
## $ DepTime           &lt;int&gt; 2116, 2109, 2111, 2112, 2124, 2145, 2114, 21...
## $ ArrTime           &lt;int&gt; 2255, 2252, 2255, 2326, 2321, 2327, 2324, 23...
## $ UniqueCarrier     &lt;chr&gt; &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;C...
## $ FlightNum         &lt;int&gt; 815, 815, 815, 815, 815, 815, 815, 815, 815,...
## $ TailNum           &lt;chr&gt; &quot;N74856&quot;, &quot;N57852&quot;, &quot;N78866&quot;, &quot;N57863&quot;, &quot;N57...
## $ ActualElapsedTime &lt;int&gt; 219, 223, 224, 254, 237, 222, 250, 231, 229,...
## $ AirTime           &lt;int&gt; 194, 191, 190, 197, 198, 200, 192, 187, 186,...
## $ ArrDelay          &lt;int&gt; 12, 6, 9, 40, 35, 41, 38, 18, 19, 10, 29, 33...
## $ DepDelay          &lt;int&gt; 6, -1, 1, 2, 14, 35, 4, 0, 6, 9, 6, 17, 38, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;L...
## $ Distance          &lt;int&gt; 1379, 1379, 1379, 1379, 1379, 1379, 1379, 13...
## $ TaxiIn            &lt;int&gt; 10, 13, 15, 18, 12, 10, 14, 19, 12, 12, 20, ...
## $ TaxiOut           &lt;int&gt; 15, 19, 19, 39, 27, 12, 44, 25, 31, 13, 39, ...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## [1] &quot;------------------------&quot;
## Observations: 95
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,...
## $ DayofMonth        &lt;int&gt; 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, ...
## $ DayOfWeek         &lt;int&gt; 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3, 2, 1, 7, 6,...
## $ DepTime           &lt;int&gt; 2116, 2109, 2111, 2112, 2124, 2145, 2114, 21...
## $ ArrTime           &lt;int&gt; 2255, 2252, 2255, 2326, 2321, 2327, 2324, 23...
## $ UniqueCarrier     &lt;chr&gt; &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;C...
## $ FlightNum         &lt;int&gt; 815, 815, 815, 815, 815, 815, 815, 815, 815,...
## $ TailNum           &lt;chr&gt; &quot;N74856&quot;, &quot;N57852&quot;, &quot;N78866&quot;, &quot;N57863&quot;, &quot;N57...
## $ ActualElapsedTime &lt;int&gt; 219, 223, 224, 254, 237, 222, 250, 231, 229,...
## $ AirTime           &lt;int&gt; 194, 191, 190, 197, 198, 200, 192, 187, 186,...
## $ ArrDelay          &lt;int&gt; 12, 6, 9, 40, 35, 41, 38, 18, 19, 10, 29, 33...
## $ DepDelay          &lt;int&gt; 6, -1, 1, 2, 14, 35, 4, 0, 6, 9, 6, 17, 38, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;L...
## $ Distance          &lt;int&gt; 1379, 1379, 1379, 1379, 1379, 1379, 1379, 13...
## $ TaxiIn            &lt;int&gt; 10, 13, 15, 18, 12, 10, 14, 19, 12, 12, 20, ...
## $ TaxiOut           &lt;int&gt; 15, 19, 19, 39, 27, 12, 44, 25, 31, 13, 39, ...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb487-1" data-line-number="1"><span class="co"># ispišite prvih pet redaka varijable `flight815` </span></a>
<a class="sourceLine" id="cb487-2" data-line-number="2"><span class="kw">head</span>(flight815)</a>
<a class="sourceLine" id="cb487-3" data-line-number="3"></a>
<a class="sourceLine" id="cb487-4" data-line-number="4"><span class="kw">print</span>(<span class="st">&quot;------------------------&quot;</span>)   </a>
<a class="sourceLine" id="cb487-5" data-line-number="5"></a>
<a class="sourceLine" id="cb487-6" data-line-number="6"><span class="co"># ispišite prvih pet redaka varijable `grouped815` </span></a>
<a class="sourceLine" id="cb487-7" data-line-number="7"><span class="kw">head</span>(grouped815)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 21
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1  2011     4         30         6    2116    2255 CO                  815
## 2  2011     4         29         5    2109    2252 CO                  815
## 3  2011     4         28         4    2111    2255 CO                  815
## 4  2011     4         27         3    2112    2326 CO                  815
## 5  2011     4         26         2    2124    2321 CO                  815
## 6  2011     4         25         1    2145    2327 CO                  815
## # ... with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;,
## #   Dest &lt;chr&gt;, Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;,
## #   Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;
## [1] &quot;------------------------&quot;
## # A tibble: 6 x 21
## # Groups:   Month [1]
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1  2011     4         30         6    2116    2255 CO                  815
## 2  2011     4         29         5    2109    2252 CO                  815
## 3  2011     4         28         4    2111    2255 CO                  815
## 4  2011     4         27         3    2112    2326 CO                  815
## 5  2011     4         26         2    2124    2321 CO                  815
## 6  2011     4         25         1    2145    2327 CO                  815
## # ... with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;,
## #   Dest &lt;chr&gt;, Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;,
## #   Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;</code></pre>
</div>
<hr />
<p>Vidimo da grupiranjem nismo “izgubili” nikakvu informaciju - grupirani podatkovni okvir i dalje izgleda identično originalnom, “negrupiranom” okviru. Zapravo jedina naznaka da je nešto drugačije jest nova, nasljeđena klasa te redak <code>Groups:..</code> u ispisu redaka. Ovo znači da je grupiranje okvira samo naznaka da se neke daljnje (najčešće agregacijske) operacije ne izvode nad cijelim okvirom, već nad pojedinim grupama. Isto tako, ukoliko želimo, okvir uvijek možemo lako “odgrupirati” uz pomoć funkcije <code>ungroup</code>.</p>
<p>Za agregaciju se koristimo funkcijom <code>summarise</code> koja prima podatke (grupiranu tablicu) a potom kombinacije agregacijskih funkcija i stupaca nad kojim se iste izvršavaju, npr.:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb489-1" data-line-number="1"><span class="kw">summarise</span>(podaci, <span class="kw">mean</span>(a), <span class="kw">sd</span>(a))</a></code></pre></div>
<p>Za agregacijsku funkciju u pravilu možemo koristiti bilo koju funkciju koja vektor vrijednosti svodi na jednu vrijednost (npr. <code>mean</code>, <code>max</code>, <code>sd</code> itd.), a često korištene funkcije koje nudi sam paket <code>dplyr</code> su:</p>
<ul>
<li><code>first</code>, <code>last</code>, <code>nth</code> - prvi, zadnji, <code>n</code>-ti element grupe</li>
<li><code>n</code>, <code>n_distinct</code> - broj (jedinstvenih) vrijednosti</li>
</ul>
<hr />
<p><strong>Zadatak 11.8 - funkcija <code>summarise</code></strong></p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" data-line-number="1"><span class="co"># izračunajte prosječno kašnjenje u dolasku leta za varijable `flight815` i `grouped815`</span></a>
<a class="sourceLine" id="cb490-2" data-line-number="2"><span class="co"># koristite funkciju `summarise`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" data-line-number="1"><span class="kw">summarise</span>(flight815, <span class="dt">meanDelay =</span> <span class="kw">mean</span>(ArrDelay))</a>
<a class="sourceLine" id="cb491-2" data-line-number="2"><span class="kw">print</span>(<span class="st">&quot;------------------------&quot;</span>)   </a>
<a class="sourceLine" id="cb491-3" data-line-number="3"><span class="kw">summarise</span>(grouped815, <span class="dt">meanDelay =</span> <span class="kw">mean</span>(ArrDelay))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   meanDelay
##       &lt;dbl&gt;
## 1      21.6
## [1] &quot;------------------------&quot;
## # A tibble: 6 x 2
##   Month meanDelay
##   &lt;int&gt;     &lt;dbl&gt;
## 1     4      21.1
## 2     5      20.9
## 3     6      28.0
## 4     8     -27.5
## 5     9      14  
## 6    10     -13</code></pre>
</div>
<p>Uočite da je poželjno imenovati agregirane stupce.</p>
<hr />
<p>U praksi ne čuvamo referencu na grupirane tablice već unutar jedne naredbe provodimo cijeli proces odabira redaka i stupaca, grupiranja i provođenja agregacije. Ako koristimo operator <code>%&gt;%</code>, onda to može izgledati ovako:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb493-1" data-line-number="1"><span class="kw">filter</span>(podaci, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">group_by</span>(a,b) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(c)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(b))</a></code></pre></div>
<p>Konačno, ponovimo još jednom lako uočljivu sličnost gornjeg izraza sa <em>SQL</em> upitima u relacijskim bazama, uz bitnu razliku da ovdje operacije provodimo proceduralno što uvelike povećava čitljivost te da vrlo lako u bilo kojem trenutku možemo pohraniti i provjeriti međurezultat.</p>
<p>Pokušajmo sada iskoristiti sva dosadašnja saznanja o paketu <code>dplyr</code> i riješiti sljedeće primjere. Svi zadaci vezani su uz cijeli podatkovni skup <code>hflights</code>.</p>
<hr />
<p><strong>Zadatak 11.9 - složeni upiti</strong></p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" data-line-number="1"><span class="co"># ispišite koliko je bilo otkazanih letova zbog </span></a>
<a class="sourceLine" id="cb494-2" data-line-number="2"><span class="co"># lošeg vremena u svakom mjesecu</span></a>
<a class="sourceLine" id="cb494-3" data-line-number="3"><span class="co"># tablica rezultata mora imati stupce </span></a>
<a class="sourceLine" id="cb494-4" data-line-number="4"><span class="co"># `Month` i `BadWeatherCancellations`</span></a>
<a class="sourceLine" id="cb494-5" data-line-number="5"></a>
<a class="sourceLine" id="cb494-6" data-line-number="6"><span class="co"># ispišite prosječno vrijeme kašnjenja u dolasku </span></a>
<a class="sourceLine" id="cb494-7" data-line-number="7"><span class="co"># (ignorirajte retke sa NA) za zrakoplovne luke </span></a>
<a class="sourceLine" id="cb494-8" data-line-number="8"><span class="co"># LAX, JFK i LGA u različitim danima u tjednu</span></a>
<a class="sourceLine" id="cb494-9" data-line-number="9"><span class="co"># novi stupac nazovite &#39;MeanArrDelay&#39;</span></a>
<a class="sourceLine" id="cb494-10" data-line-number="10"><span class="co"># ispis poredajte po vremenu kašnjenja silazno</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb495-1" data-line-number="1"><span class="co"># ispišite koliko je bilo otkazanih letova zbog </span></a>
<a class="sourceLine" id="cb495-2" data-line-number="2"><span class="co"># lošeg vremena u svakom mjesecu</span></a>
<a class="sourceLine" id="cb495-3" data-line-number="3"><span class="co"># tablica rezultata mora imati stupce </span></a>
<a class="sourceLine" id="cb495-4" data-line-number="4"><span class="co"># `Month` i `BadWeatherCancellations`</span></a>
<a class="sourceLine" id="cb495-5" data-line-number="5"></a>
<a class="sourceLine" id="cb495-6" data-line-number="6"><span class="kw">filter</span>(hflights, CancellationCode <span class="op">==</span><span class="st"> &#39;B&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb495-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(Month) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb495-8" data-line-number="8"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">BadWeatherCancellations =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    Month BadWeatherCancellations
##    &lt;int&gt;                   &lt;int&gt;
##  1     1                     149
##  2     2                     929
##  3     3                      50
##  4     4                      40
##  5     5                     106
##  6     6                      49
##  7     7                      29
##  8     8                     108
##  9     9                      38
## 10    10                      46
## 11    11                      13
## 12    12                      95</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb497-1" data-line-number="1"><span class="co"># ispišite prosječno vrijeme kašnjenja u dolasku </span></a>
<a class="sourceLine" id="cb497-2" data-line-number="2"><span class="co"># (ignorirajte retke sa NA) za zrakoplovne luke </span></a>
<a class="sourceLine" id="cb497-3" data-line-number="3"><span class="co"># LAX, JFK i LGA u različitim danima u tjednu</span></a>
<a class="sourceLine" id="cb497-4" data-line-number="4"><span class="co"># novi stupac nazovite &#39;MeanArrDelay&#39;</span></a>
<a class="sourceLine" id="cb497-5" data-line-number="5"><span class="co"># ispis poredajte po vremenu kašnjenja silazno</span></a>
<a class="sourceLine" id="cb497-6" data-line-number="6"></a>
<a class="sourceLine" id="cb497-7" data-line-number="7"></a>
<a class="sourceLine" id="cb497-8" data-line-number="8"><span class="kw">filter</span>(hflights, Dest <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;LAX&#39;</span>, <span class="st">&#39;JFK&#39;</span>, <span class="st">&#39;LGA&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(DayOfWeek, Dest) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb497-9" data-line-number="9"><span class="kw">summarise</span>(<span class="dt">MeanArrDelay =</span> <span class="kw">round</span>(<span class="kw">mean</span>(ArrDelay, </a>
<a class="sourceLine" id="cb497-10" data-line-number="10">         <span class="dt">na.rm =</span> T) , <span class="dv">2</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb497-11" data-line-number="11"><span class="st">         </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(MeanArrDelay))</a></code></pre></div>
<pre><code>## # A tibble: 21 x 3
##    DayOfWeek Dest  MeanArrDelay
##        &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1         4 LGA          21.3 
##  2         4 JFK          17.2 
##  3         5 LGA          13.6 
##  4         1 LGA          13.5 
##  5         7 JFK          10.8 
##  6         1 LAX          10.7 
##  7         3 LGA          10.5 
##  8         4 LAX          10.3 
##  9         2 LGA           9.85
## 10         6 JFK           9.76
## # ... with 11 more rows</code></pre>
</div>
<p><strong>Zadatak 11.10 - složeni upiti (2)</strong></p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb499-1" data-line-number="1"><span class="co"># u zadacima koji slijede zamislite da ste prvo napisali</span></a>
<a class="sourceLine" id="cb499-2" data-line-number="2"><span class="co"># &quot;vlastitu&quot; funkciju koja pronalazi najčešću kategoriju:</span></a>
<a class="sourceLine" id="cb499-3" data-line-number="3">mostFreqValue &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">table</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sort</span>(<span class="dt">decreasing =</span> T) <span class="op">%&gt;%</span><span class="st"> </span>names <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[</span><span class="st">`</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb499-4" data-line-number="4"></a>
<a class="sourceLine" id="cb499-5" data-line-number="5"></a>
<a class="sourceLine" id="cb499-6" data-line-number="6"><span class="co"># u tablici `hflights` podijelite vrijeme kašnjenja </span></a>
<a class="sourceLine" id="cb499-7" data-line-number="7"><span class="co"># u dolasku u 10 kategorija uz pomoć funkcije `ntile`</span></a>
<a class="sourceLine" id="cb499-8" data-line-number="8"><span class="co"># novi stupac nazovite `ArrDelayCatId`</span></a>
<a class="sourceLine" id="cb499-9" data-line-number="9"><span class="co"># za svaku tu kategoriju ispišite identifikator </span></a>
<a class="sourceLine" id="cb499-10" data-line-number="10"><span class="co"># kategorije, ukupan broj letova unutar kategorije,</span></a>
<a class="sourceLine" id="cb499-11" data-line-number="11"><span class="co"># minimalno i maksimalno vrijeme kašnjenja u dolasku </span></a>
<a class="sourceLine" id="cb499-12" data-line-number="12"><span class="co"># te koja zrakoplovna luka se najčešće </span></a>
<a class="sourceLine" id="cb499-13" data-line-number="13"><span class="co"># pojavljuje u toj kategoriji</span></a>
<a class="sourceLine" id="cb499-14" data-line-number="14"></a>
<a class="sourceLine" id="cb499-15" data-line-number="15"></a>
<a class="sourceLine" id="cb499-16" data-line-number="16"><span class="co"># ponovite prethodni primjer ali umjesto funkcije </span></a>
<a class="sourceLine" id="cb499-17" data-line-number="17"><span class="co"># `ntile` isprobajte funkciju `cut`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb500-1" data-line-number="1"><span class="co"># u tablici `hflights` podijelite vrijeme kašnjenja </span></a>
<a class="sourceLine" id="cb500-2" data-line-number="2"><span class="co"># u dolasku u 10 kategorija uz pomoć funkcije `ntile`</span></a>
<a class="sourceLine" id="cb500-3" data-line-number="3"><span class="co"># novi stupac nazovite `ArrDelayCatId`</span></a>
<a class="sourceLine" id="cb500-4" data-line-number="4"><span class="co"># za svaku tu kategoriju ispišite identifikator </span></a>
<a class="sourceLine" id="cb500-5" data-line-number="5"><span class="co"># kategorije, ukupan broj letova unutar kategorije,</span></a>
<a class="sourceLine" id="cb500-6" data-line-number="6"><span class="co"># minimalno i maksimalno vrijeme kašnjenja u dolasku </span></a>
<a class="sourceLine" id="cb500-7" data-line-number="7"><span class="co"># te koja zrakoplovna luka se najčešće </span></a>
<a class="sourceLine" id="cb500-8" data-line-number="8"><span class="co"># pojavljuje u toj kategoriji</span></a>
<a class="sourceLine" id="cb500-9" data-line-number="9"></a>
<a class="sourceLine" id="cb500-10" data-line-number="10"><span class="kw">mutate</span>(hflights, <span class="dt">ArrDelayCatId =</span> <span class="kw">ntile</span>(ArrDelay, <span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb500-11" data-line-number="11"><span class="kw">group_by</span>(ArrDelayCatId) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">totalFlights =</span> <span class="kw">n</span>(), <span class="dt">minArrDelay =</span> <span class="kw">min</span>(ArrDelay), <span class="dt">maxArrDelay =</span> <span class="kw">max</span>(ArrDelay), <span class="dt">mostFreqDest =</span> <span class="kw">mostFreqValue</span>(Dest))</a></code></pre></div>
<pre><code>## # A tibble: 11 x 5
##    ArrDelayCatId totalFlights minArrDelay maxArrDelay mostFreqDest
##            &lt;int&gt;        &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;       
##  1             1        22388         -70         -14 ATL         
##  2             2        22387         -14          -9 ATL         
##  3             3        22388          -9          -6 DAL         
##  4             4        22387          -6          -3 DAL         
##  5             5        22387          -3           0 DAL         
##  6             6        22388           0           3 DAL         
##  7             7        22387           3           8 DAL         
##  8             8        22388           8          15 DAL         
##  9             9        22387          15          32 DAL         
## 10            10        22387          32         978 DAL         
## 11            NA         3622          NA          NA DAL</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb502-1" data-line-number="1"><span class="co"># ponovite prethodni primjer ali umjesto funkcije </span></a>
<a class="sourceLine" id="cb502-2" data-line-number="2"><span class="co"># `ntile` isprobajte funkciju `cut`</span></a>
<a class="sourceLine" id="cb502-3" data-line-number="3"></a>
<a class="sourceLine" id="cb502-4" data-line-number="4"><span class="kw">mutate</span>(hflights, <span class="dt">ArrDelayCat =</span> <span class="kw">cut</span>(ArrDelay, <span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb502-5" data-line-number="5"><span class="kw">group_by</span>(ArrDelayCat) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">totalFlights =</span> <span class="kw">n</span>(), <span class="dt">minArrDelay =</span> <span class="kw">min</span>(ArrDelay), <span class="dt">maxArrDelay =</span> <span class="kw">max</span>(ArrDelay), <span class="dt">mostFreqDest =</span> <span class="kw">mostFreqValue</span>(Dest))</a></code></pre></div>
<pre><code>## # A tibble: 11 x 5
##    ArrDelayCat totalFlights minArrDelay maxArrDelay mostFreqDest
##    &lt;fct&gt;              &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;       
##  1 (-71,34.8]        203101         -70          34 DAL         
##  2 (34.8,140]         18551          35         139 DAL         
##  3 (140,244]           1849         140         244 ATL         
##  4 (244,349]            294         245         346 ATL         
##  5 (349,454]             48         350         450 ATL         
##  6 (454,559]             16         458         556 ATL         
##  7 (559,664]              4         579         663 DFW         
##  8 (664,768]              4         685         766 DFW         
##  9 (768,873]              4         775         861 DEN         
## 10 (873,979]              3         918         978 DFW         
## 11 &lt;NA&gt;                3622          NA          NA DAL</code></pre>
</div>
<hr />
</div>
<div id="spajanje-podatkovnih-okvira-uz-join-funkcije" class="section level2">
<h2><span class="header-section-number">11.7</span> Spajanje podatkovnih okvira uz join funkcije</h2>
<p>Spajanje podatkovnih okvira jest operacija poznata svim programerima koji imaju iskustvo u radu sa relacijskim bazama podataka i <em>SQL</em>-om. Kod pohrane u relacijsku bazu podataka tablice se često dekomponiraju u više tablica postupkom koji se naziva “normalizacija”. Svrha normalizacije je poglavito uklanjanje nepotrebne redundancije - svaka tablica zadržava dovoljno podataka kako bi se prema potrebi operacijom spajanja mogli rekonstruirati originalni podaci tj. skupovi obzervacija.</p>
<p>Iako postoje različiti oblici spajanja tablica, daleko najčešće je tzv. “prirodno” spajanje kod koje u jednoj tablici imamo jedinstvene identifikatore vezane uz podatke koji se nalaze u drugoj tablici. Na primjer - zamislimo da imamo tablice Korisnik i Mjesto, gdje tablica korisnika sustava može imati stupac koji pohranjuje poštanski broj mjesta boravišta korisnika, dok se ostali podaci vezani uz mjesta nalaze u drugoj tablici. Pohraniti naziv mjesta u tablicu s korisnicima bilo bi redundantno, budući da poštanski broj kao takav jedinstveno identificira mjesto, a ukoliko želimo kod ispisa korisnika vidjeti i nazive mjesta, obavljamo operaciju prirodnog spajanja dvije tablice po poštanskom broju mjesta koje je tzv. “strani ključ” u tablici <em>Korisnik</em> a istovremeno i “primarni ključ” u tablici <em>Mjesto</em>.</p>
<p>Stvorimo ovakve podatkovne okvire (sa tek nekoliko redaka kako bi koncept bio jasniji).</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb504-1" data-line-number="1"><span class="co"># inicijalizacija podatkovnih okvira `korisnik` i `mjesto`</span></a>
<a class="sourceLine" id="cb504-2" data-line-number="2"></a>
<a class="sourceLine" id="cb504-3" data-line-number="3">korisnik &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">id =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>), <span class="dt">prezime =</span> <span class="kw">c</span>(<span class="st">&quot;Ivic&quot;</span>, <span class="st">&quot;Peric&quot;</span>, <span class="st">&quot;Anic&quot;</span>),</a>
<a class="sourceLine" id="cb504-4" data-line-number="4">                        <span class="dt">pbrBoravista =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">31000</span>, <span class="dv">10000</span>))</a>
<a class="sourceLine" id="cb504-5" data-line-number="5"></a>
<a class="sourceLine" id="cb504-6" data-line-number="6">mjesto &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">pbr =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">21000</span>, <span class="dv">31000</span>), </a>
<a class="sourceLine" id="cb504-7" data-line-number="7">                      <span class="dt">naziv =</span> <span class="kw">c</span>(<span class="st">&quot;Zagreb&quot;</span>, <span class="st">&quot;Split&quot;</span>, <span class="st">&quot;Osijek&quot;</span>))</a></code></pre></div>
<p>Ako bi htjeli imati okvir sa stupcima <em>(id, prezime, pbrBoravista, naziv)</em>, moramo prirodno spojiti ova dva okvira. Paket <code>dplyr</code> za ovo nudi funkciju <code>inner_join</code>:</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb505-1" data-line-number="1"><span class="kw">inner_join</span>(df1, df2, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;s1&quot;</span> =<span class="st"> &quot;s2&quot;</span>))</a></code></pre></div>
<p>gdje su <code>df1</code> i <code>df2</code> podatkovni okviri koje spajamo, a nizovi znakova <em>“s1”</em> i <em>“s2”</em> označavaju imena stupaca “lijevog” i “desnog” okvira prema kojima provodimo spajanje (uočite samo jedan znak jednakosti!). Ukoliko stupac kojeg koristimo ima isto ime u obje tablice možemo navesti samo ime tog stupca (ili znakovni vektor više stupaca ako spajamo preko tzv. “kompozitnog” stranog ključa), ili taj parametar potpuno ispustiti (ako su stupci prema kojima provodimo spajanje jedini stupci čiji se nazivi poklapaju).</p>
<hr />
<p><strong>Zadatak 11.11 - prirodno spajanje</strong></p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb506-1" data-line-number="1"><span class="co"># stvorite okvir `korisnikMjesto` koji će biti rezultat</span></a>
<a class="sourceLine" id="cb506-2" data-line-number="2"><span class="co"># prirodnog spajanja okvira `korisnik` i `mjesto`</span></a>
<a class="sourceLine" id="cb506-3" data-line-number="3"></a>
<a class="sourceLine" id="cb506-4" data-line-number="4"></a>
<a class="sourceLine" id="cb506-5" data-line-number="5"><span class="co"># ispišite okvir `korisnikMjesto`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb507-1" data-line-number="1">korisnikMjesto &lt;-<span class="st"> </span><span class="kw">inner_join</span>(korisnik, mjesto, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;pbrBoravista&quot;</span> =<span class="st"> &quot;pbr&quot;</span>))</a>
<a class="sourceLine" id="cb507-2" data-line-number="2"></a>
<a class="sourceLine" id="cb507-3" data-line-number="3"></a>
<a class="sourceLine" id="cb507-4" data-line-number="4">korisnikMjesto</a></code></pre></div>
<pre><code>##   id prezime pbrBoravista  naziv
## 1  1    Ivic        10000 Zagreb
## 2  2   Peric        31000 Osijek
## 3  3    Anic        10000 Zagreb</code></pre>
</div>
<hr />
<p>Vodite računa da je spajanje vrlo “skupa” operacija; ako spajate okvire sa vrlo velikim brojem redaka operacija bi mogla trajati vrlo dugo i zauzeti dosta memorije. U slučaju da često dolazi do potrebe za ovakvim “velikim” spajanjima, onda se snažno preporučuje korištenje paketa data.table koji implementira algoritme sa znatno boljim performansama kod operacija spajanja (korištenjem indeksiranja), ili - ukoliko radimo s podacima iz relacijske baze - provesti spajanja na strani baze podataka i onda u <em>R</em> povući rezultat, umjesto da se spajanje ostavlja na odgovornost <em>R</em>-u. U idućem poglavlju prikazati ćemo kako se ovo potencijalno može izvesti i bez potrebe za pisanjem zasebnih <em>SQL</em> naredbi.</p>
<p>Ako pogledamo rezultat gornjeg primjera, možemo vidjeti da smo “izgubili” jedan redak tablice mjesto. Naime, redak <em>(21000, ‘Split’)</em> nije imao pripadajućeg korisnika te je “nestao” iz rezultata. Ovo je potpuno očekivani rezultat prirodnog spajanja, no postoje slučajevi kada želimo zadržati sve retke iz jedne od tablica koje spajamo. U tom slučaju koristimo tzv. “vanjsko spajanje” koje radi identično već viđenom, ali zadržava sve retke iz jedne ili obje od tablica na način da retci koji se ne uspiju spojiti ostaju u rezultatu, ali sa <code>NA</code> vrijednostima sa suprotne strane. Razlikujemo “lijevo”, “desno”, i “puno” vanjsko spajanje, u ovisnosti želimo li zadržati sve retke iz lijeve, desne ili obje tablice. Paket <code>dplyr</code> nudi funkcije koje obavljaju sve ove tipove spajanja, one imaju potpis identičan gore viđenoj funkciji a zovu se <code>left_join</code>, <code>right_join</code> i <code>full_join</code>.</p>
<hr />
<p><strong>Zadatak 11.12 - vanjsko spajanje</strong></p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb509-1" data-line-number="1"><span class="co"># stvorite okvir `korisnikMjesto2` koji će biti rezultat</span></a>
<a class="sourceLine" id="cb509-2" data-line-number="2"><span class="co"># prirodnog spajanja okvira `korisnik` i `mjesto`</span></a>
<a class="sourceLine" id="cb509-3" data-line-number="3"><span class="co"># ali će zadržati sve retke iz tablice &#39;mjesto`</span></a>
<a class="sourceLine" id="cb509-4" data-line-number="4"></a>
<a class="sourceLine" id="cb509-5" data-line-number="5"><span class="co"># ispišite okvir `korisnikMjesto2`</span></a>
<a class="sourceLine" id="cb509-6" data-line-number="6"><span class="co"># retke poredajte po identifikatoru korisnika</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb510-1" data-line-number="1">korisnikMjesto2 &lt;-<span class="st"> </span><span class="kw">right_join</span>(korisnik, mjesto, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;pbrBoravista&quot;</span> =<span class="st"> &quot;pbr&quot;</span>))</a>
<a class="sourceLine" id="cb510-2" data-line-number="2"></a>
<a class="sourceLine" id="cb510-3" data-line-number="3"></a>
<a class="sourceLine" id="cb510-4" data-line-number="4">korisnikMjesto2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(id)</a></code></pre></div>
<pre><code>##   id prezime pbrBoravista  naziv
## 1  1    Ivic        10000 Zagreb
## 2  2   Peric        31000 Osijek
## 3  3    Anic        10000 Zagreb
## 4 NA    &lt;NA&gt;        21000  Split</code></pre>
</div>
<hr />
</div>
<div id="integracija-sa-relacijskim-bazama-podataka" class="section level2">
<h2><span class="header-section-number">11.8</span> Integracija sa relacijskim bazama podataka</h2>
<p>Relacijske baze česti su izvor podataka za analize koje radimo u jeziku <em>R</em>. Jedna od standardnih procedura pripreme podataka za analitički proces je tzv. “izvoženje” (engl. <em>export</em>) podataka iz baze u <em>CSV</em> datoteku, koja se potom učitava u <em>R</em>. Često se prije stvaranja <em>CSV</em> datoteke prvo podaci iz baze moraju prikupiti i pripremiti na adekvatan način, što znači da cjelokupni proces pripreme podataka incijalno zahtjeva rad u <em>SQL</em>-u nad bazom podataka. Ovo je pogotovo bitno ako radimo sa većim skupovima podataka koji bi nepotrebno opteretili stroj nad kojim radimo analize u <em>R</em>-u, a koji bi se mogli znatno učinkovitije i brže mogli obraditi u bazi podataka.</p>
<p>Gore navedeno ne znači nužno da nam za prikupljanje podataka iz baze treba zaseban alat pomoću kojeg ćemo izvoditi <em>SQL</em> upite. <em>R</em> sadrži niz paketa za direktno spajanje i rad sa popularnijim bazama podataka, kao što su npr. <em>MySQL</em> ili <em>PostgreSQL</em>. Uz pomoć ovih paketa možemo unutar <em>R</em> skripte uspostaviti konekciju sa bazom i izvoditi <em>SQL</em> upite, a sve uz pomoć R naredbi pri čemu kao konačni rezultat dobivamo podatkovni okvir spreman za daljnje korake analize. Npr. rad direktno nad <em>MySQL</em> bazom može izgledati ovako:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb512-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;RMySQL&quot;</span>)</a>
<a class="sourceLine" id="cb512-2" data-line-number="2"></a>
<a class="sourceLine" id="cb512-3" data-line-number="3"><span class="kw">library</span>(RMySQL)</a>
<a class="sourceLine" id="cb512-4" data-line-number="4"></a>
<a class="sourceLine" id="cb512-5" data-line-number="5"><span class="co"># unijeti stvarne parametre kod realnog scenarija!</span></a>
<a class="sourceLine" id="cb512-6" data-line-number="6">conn =<span class="st"> </span><span class="kw">dbConnect</span>(<span class="kw">MySQL</span>(), <span class="dt">user=</span><span class="st">&#39;user&#39;</span>, <span class="dt">password=</span><span class="st">&#39;password&#39;</span>, <span class="dt">dbname=</span><span class="st">&#39;database_name&#39;</span>, <span class="dt">host=</span><span class="st">&#39;host&#39;</span>)</a>
<a class="sourceLine" id="cb512-7" data-line-number="7"></a>
<a class="sourceLine" id="cb512-8" data-line-number="8">df =<span class="st"> </span><span class="kw">dbSendQuery</span>(conn, <span class="st">&quot;SELECT * FROM MY_TABLE&quot;</span>)</a></code></pre></div>
<p>Vidimo da prvo moramo učitati paket s podrškom za spajanje na odabranu bazu, potom uspostavljamo konekciju sa bazom (parametre nam obično daje administrator same baze), a onda uz pomoć odgovarajućih funkcija postavljamo <em>SQL</em> upite). Iako ovakav pristup nije kompliciran i relativno se često koristi, on neumitno zahtijeva miješanje programskog koda u <em>SQL</em>-u i programskog koda u <em>R</em>-u.</p>
<p>Paket dplyr može ovdje pomoći na način da rastereti programera od potrebe pisanja <em>SQL</em> upita unutar <em>R</em> skripte. Naime, <code>dplyr</code> sadrži integriranu podršku za automatsku konverziju izraza koji koriste <code>dplyr</code> funkcije direktno u <em>SQL</em> upit, a što je transparentno za korisnika. Drugim riječima, do izvjesne mjere možemo na isti način raditi nad relacijskom bazom podataka kao da se radi o podatkovnim okvirima u memoriji računala. Ovdje trebamo biti oprezni jer ne možemo očekivati da će nam sve funkcionalnosti <code>dplyr</code>-a moći biti automatski prevedene u <em>SQL</em>, ali neke standardne pripremne operacije poput spajanje i filtriranja se na ovaj način mogu raditi direktno u bazi, a kroz čisti <em>R</em> programski kod.</p>
<p>Kako bi mogli ovo isprobati u praksi, potrebna nam je relacijska baza podataka. Budući da nije praktično u ovom trenutku instalirati ili pripremati postojeću relacijsku bazu podataka samo za potrebe nekolicine primjera, učinit ćemo ono što radi većina <em>R</em> programera kada želi razvijati programski kod vezan uz relacijske baze, ali izbjeći potrebu za pristupom konkretnoj bazi podataka - koristiti ćemo se tzv. <em>SQLite </em>bazom. Ovo je jednostavna baza koja ne zahtijeva posebnu instalaciju, ne koristi poslužitelj i sve podatke drži u jednoj datoteci.</p>
<p>U sljedećem programskom odsječku učitavamo paket <em>RSQLite</em>, stvaramo novu bazu kreiranjem nove datoteke (ili se spajamo na postojeću ako datoteka ne postoji) te spremamo okvir <code>mtcars</code> u tablicu <em>AUTI</em> što će nam glumiti “podatke u bazi”.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb513-1" data-line-number="1"><span class="co"># instalacija i učitavanje paketa `RSQLite` (izvesti ako je potrebno)</span></a>
<a class="sourceLine" id="cb513-2" data-line-number="2"><span class="co">#install.packages(&quot;RSQLite&quot;)      </span></a>
<a class="sourceLine" id="cb513-3" data-line-number="3"><span class="co">#library(RSQLite)                 </span></a>
<a class="sourceLine" id="cb513-4" data-line-number="4"></a>
<a class="sourceLine" id="cb513-5" data-line-number="5"><span class="co"># otvaramo konekciju sa bazom &quot;SQLite&quot;</span></a>
<a class="sourceLine" id="cb513-6" data-line-number="6"><span class="co"># (zapravo stvaramo datoteku &#39;moja.baza&#39;)</span></a>
<a class="sourceLine" id="cb513-7" data-line-number="7">conn &lt;-<span class="kw">dbConnect</span>(<span class="dt">drv=</span><span class="kw">SQLite</span>(), <span class="dt">dbname=</span><span class="st">&quot;moja.baza&quot;</span>)</a>
<a class="sourceLine" id="cb513-8" data-line-number="8"></a>
<a class="sourceLine" id="cb513-9" data-line-number="9"><span class="co"># stvaramo tablicu `AUTI` u koju pohranjujemo</span></a>
<a class="sourceLine" id="cb513-10" data-line-number="10"><span class="co"># prvih 100 redaka tablice `mtcars`</span></a>
<a class="sourceLine" id="cb513-11" data-line-number="11"><span class="co"># ovo simulira &quot;tablicu u bazi&quot;</span></a>
<a class="sourceLine" id="cb513-12" data-line-number="12"><span class="kw">dbWriteTable</span>(conn, <span class="st">&quot;AUTI&quot;</span>, mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,], <span class="dt">overwrite =</span> T)</a>
<a class="sourceLine" id="cb513-13" data-line-number="13"></a>
<a class="sourceLine" id="cb513-14" data-line-number="14"><span class="co"># provjeramo popis svih tablica</span></a>
<a class="sourceLine" id="cb513-15" data-line-number="15"><span class="kw">dbListTables</span>(conn)</a></code></pre></div>
<pre><code>## [1] &quot;AUTI&quot;</code></pre>
<p>Uobičajeni način prikupljanja podataka iz baze jest ugradnja <em>SQL</em> upita direktno u <em>R</em> programski kod i pohrana rezultata u varijablu.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb515-1" data-line-number="1"><span class="co"># ispisujemo podatke o maksimalnoj brzini i težini svih automobila sa 6 cilindara</span></a>
<a class="sourceLine" id="cb515-2" data-line-number="2"></a>
<a class="sourceLine" id="cb515-3" data-line-number="3"><span class="kw">dbGetQuery</span>(conn, <span class="st">&quot;SELECT mpg, wt FROM AUTI WHERE cyl = 6&quot;</span>)</a></code></pre></div>
<pre><code>##    mpg    wt
## 1 21.0 2.620
## 2 21.0 2.875
## 3 21.4 3.215
## 4 18.1 3.460
## 5 19.2 3.440
## 6 17.8 3.440
## 7 19.7 2.770</code></pre>
<p>Ako dobro poznajemo SQL, onda ovakav način prikupljanja podataka vjerojatno ne izgleda pretjerano kompleksno i uistinu, veliki broj programera i analitičara rado kombinira <em>SQL</em> i <em>R</em> kako bi optimizirali proces prikupljanja i pripreme podataka. No ako nismo “jaki” u <em>SQ</em>L-u, ili jednostavno želimo “čistiji” kod, možemo se koristiti alatima koje nam nudi paket <code>dplyr</code>.</p>
<p>U idućem primjeru ponoviti ćemo dio gore prikazanog postupka (spojiti ćemo se na <em>SQLite</em> bazu nazvanu <em>moja.baza</em> i ispisati podatke iz tablice <em>AUTI</em>), ali ćemo sve izvesti uz pomoć <code>dplyr</code> funkcija.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb517-1" data-line-number="1"><span class="co"># povezujem se sa postojećom SQLite bazom</span></a>
<a class="sourceLine" id="cb517-2" data-line-number="2">conn2 &lt;-<span class="st"> </span><span class="kw">src_sqlite</span>(<span class="st">&quot;moja.baza&quot;</span>, <span class="dt">create =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb517-3" data-line-number="3"></a>
<a class="sourceLine" id="cb517-4" data-line-number="4"><span class="co"># pogledajmo da li je tablica AUTI u bazi</span></a>
<a class="sourceLine" id="cb517-5" data-line-number="5"><span class="kw">src_tbls</span>(conn2)</a>
<a class="sourceLine" id="cb517-6" data-line-number="6"></a>
<a class="sourceLine" id="cb517-7" data-line-number="7"><span class="co"># stvaram referencu na ovu tablicu</span></a>
<a class="sourceLine" id="cb517-8" data-line-number="8"><span class="co"># (ništa se ne učitava dok ne pristupam podacima!)</span></a>
<a class="sourceLine" id="cb517-9" data-line-number="9">auti &lt;-<span class="st"> </span><span class="kw">tbl</span>(conn2, <span class="st">&quot;AUTI&quot;</span>)</a>
<a class="sourceLine" id="cb517-10" data-line-number="10"></a>
<a class="sourceLine" id="cb517-11" data-line-number="11"><span class="co"># ispisujemo podatke o maksimalnoj brzini i težini svih automobila sa 6 cilindara</span></a>
<a class="sourceLine" id="cb517-12" data-line-number="12">auti <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(cyl <span class="op">==</span><span class="st"> </span><span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(mpg, wt) <span class="op">%&gt;%</span><span class="st"> </span>collect</a></code></pre></div>
<pre><code>## [1] &quot;AUTI&quot;
## # A tibble: 7 x 2
##     mpg    wt
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  21    2.62
## 2  21    2.88
## 3  21.4  3.22
## 4  18.1  3.46
## 5  19.2  3.44
## 6  17.8  3.44
## 7  19.7  2.77</code></pre>
<p>Ključno je znati da <code>dplyr</code> neće ništa izvoditi do trenutka kada mi eksplicitno zatražimo tražene podatke, a i tada će ih dohvaćati “u porcijama” kako nam ne bi zagušio memoriju. Upravo zbog toga smo u gornjem primjeru koristili funkciju <code>collect</code>, koja zapravo znači “dohvati cijeli rezultat i pohrani ga u podatkovni okvir” (u našem slučaju mi smo ga jednostavno ispisali na zaslon). Na ovaj način <em>R</em> programer može znatno rasteretiti svoju <em>R</em> okolinu prebacujući odgovornost “teških” proračuna na bazu podataka, a sve uz korištenje istih funkcija koje koristi za upravljanje podatkovnim skupovima pohranjenim u memoriji računala u obliku podatkovnih okvira.</p>
<hr />
</div>
<div id="zadaci-za-vjezbu-9" class="section level2 unnumbered">
<h2>Zadaci za vježbu</h2>
<p>U zadacima za vježbu poslužiti ćemo se proširenom podatkovnim skupom <em>mammals sleep</em> dostupnim u vizualizacijskom paketu <code>ggplot2</code>. Učitajte paket <code>ggplot2</code> te potom prenesite podatkovni okvir <code>msleep</code> u globalnu okolinu uz pomoć funkcije <code>data</code>.</p>
<p>Prije rješavanja učitajte podatkovni skup i upoznajte se s njim uz pomoć uobičajenih funkcija.</p>
<ol style="list-style-type: decimal">
<li><p>Za 10 biljojeda koji najdulje spavaju ispišite ime, koliko dnevno spavaju i prosječnu tjelesnu, težinu u kg. Ispis poredajte po duljini spavanja silazno.</p></li>
<li><p>Ispišite prosječno, najdulje i najkraće vrijeme spavanja životinja ovisno o njihovom tipu prehrane.</p></li>
<li><p>Podijelite ukupno vrijeme spavanja u 5 razreda jednoliko po ukupnoj duljini dnevnog spavanja. Za svaki razred ispišite ukupan broj životinja koje pripadaju razredu, a potom posebno ukupan broj pripadnika razreda koji nisu biljojedi. Ispis poredajte od razreda životinja koje najmanje spavaju naviše. Stupce nazovite smisleno i pripazite da konačna tablica nema NA vrijednosti.</p></li>
<li><p>Sljedeći okvir sadrži šifre statusa očuvanja životinja i njihove opise:</p></li>
</ol>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb519-1" data-line-number="1">conservationStatus &lt;-<span class="st"> </span><span class="kw">data.frame</span>( </a>
<a class="sourceLine" id="cb519-2" data-line-number="2">  <span class="dt">code =</span> <span class="kw">c</span>(<span class="st">&quot;ex&quot;</span>, <span class="st">&quot;ew&quot;</span>, <span class="st">&quot;cr&quot;</span>, <span class="st">&quot;en&quot;</span>, <span class="st">&quot;vu&quot;</span>, <span class="st">&quot;nt&quot;</span>, <span class="st">&quot;cd&quot;</span>, <span class="st">&quot;lc&quot;</span>),</a>
<a class="sourceLine" id="cb519-3" data-line-number="3">  <span class="dt">description =</span> <span class="kw">c</span>(<span class="st">&quot;extinct&quot;</span>, <span class="st">&quot;extinct in the wild&quot;</span>, </a>
<a class="sourceLine" id="cb519-4" data-line-number="4">                 <span class="st">&quot;critically endangered&quot;</span>, <span class="st">&quot;endangered&quot;</span>,</a>
<a class="sourceLine" id="cb519-5" data-line-number="5">                 <span class="st">&quot;vulnerable&quot;</span>, <span class="st">&quot;near threatened&quot;</span>, </a>
<a class="sourceLine" id="cb519-6" data-line-number="6">                 <span class="st">&quot;conservation dependent&quot;</span>, <span class="st">&quot;least concern&quot;</span>))</a></code></pre></div>
<p>Dodajte okviru <code>msleep</code> stupac <code>conservationDesc</code> koji će sadržavati pripadajuće opise preuzete iz gornjeg okvira. Pripazite da kod proširenja ne izgubite nijedan redak iz okvira <code>msleep</code>.</p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

<div id="refs" class="references">
<div>
<p>Bache, Stefan Milton, and Hadley Wickham. 2014. <em>Magrittr: A Forward-Pipe Operator for R</em>. <a href="https://CRAN.R-project.org/package=magrittr">https://CRAN.R-project.org/package=magrittr</a>.</p>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datumi.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed",
"edit": null,
"download": null,
"search": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
